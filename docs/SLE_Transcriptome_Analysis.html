<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eduard Magerusan">

<title>SLE_Transcriptome_Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SLE_Transcriptome_Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="SLE_Transcriptome_Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="SLE_Transcriptome_Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="SLE_Transcriptome_Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SLE_Transcriptome_Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="SLE_Transcriptome_Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SLE_Transcriptome_Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SLE_Transcriptome_Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SLE_Transcriptome_Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SLE_Transcriptome_Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SLE_Transcriptome_Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eduard Magerusan </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="reanalysis-of-rna-seq-data-from-multicell-type-gene-coexpression-network-analysis-reveals-coordinated-interferon-response-and-crosscell-type-correlations-in-systemic-lupus-erythematosus" class="level2">
<h2 class="anchored" data-anchor-id="reanalysis-of-rna-seq-data-from-multicell-type-gene-coexpression-network-analysis-reveals-coordinated-interferon-response-and-crosscell-type-correlations-in-systemic-lupus-erythematosus">Reanalysis of RNA-Seq Data from ‘Multi–Cell Type Gene Coexpression Network Analysis Reveals Coordinated Interferon Response and Cross–Cell Type Correlations in Systemic Lupus Erythematosus’</h2>
<p>Systemic lupus erythematosus is a complex autoimmune disease characterized by dysregulated immune responses involving multiple cell types. In this study, we perform a reanalysis of publicly available bulk RNA-seq data from GSE149050 to identify differentially expressed genes and enriched pathways associated with SLE pathogenesis.</p>
</section>
<section id="loading-the-dataset" class="level1">
<h1>1. Loading the dataset</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core Bioconductor</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: S4Vectors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    anyDuplicated, aperm, append, as.data.frame, basename, cbind,
    colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,
    get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,
    match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,
    Position, rank, rbind, Reduce, rownames, sapply, saveRDS, setdiff,
    table, tapply, union, unique, unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'S4Vectors'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:utils':

    findMatches</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    expand.grid, I, unname</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: IRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomicRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomeInfoDb</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SummarizedExperiment</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MatrixGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: matrixStats</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MatrixGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    colWeightedMeans, colWeightedMedians, colWeightedSds,
    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    rowWeightedSds, rowWeightedVars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Biobase'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatrixGenerics':

    rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    anyMissing, rowMedians</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tximport)       </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)          </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene information</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AnnotationDbi)  </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Hs.eg.db)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:Biobase':

    combine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:BiocGenerics':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)       </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnhancedVolcano)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Data wrangling</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)         </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:gridExtra':

    combine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:AnnotationDbi':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:Biobase':

    combine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:matrixStats':

    count</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:GenomicRanges':

    intersect, setdiff, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:GenomeInfoDb':

    intersect</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:IRanges':

    collapse, desc, intersect, setdiff, slice, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:S4Vectors':

    first, intersect, rename, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:BiocGenerics':

    combine, intersect, setdiff, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dbscan'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    as.dendrogram</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(apeglm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/GSE149050_Bulk_Human_RawCounts.txt"</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">row.names =</span> <span class="dv">1</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">quote =</span> <span class="st">""</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">comment.char =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/SraRunTable.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="metadata-preprocessing-and-matching" class="level1">
<h1>2. Metadata Preprocessing and Matching</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>cell_type_clean <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" cells"</span>, <span class="st">""</span>, metadata<span class="sc">$</span>cell_type)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(metadata<span class="sc">$</span>patientid, <span class="st">"_"</span>, metadata<span class="sc">$</span>ifn_status, <span class="st">"_"</span>, metadata<span class="sc">$</span>cell_type_clean)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the number prefix (e.g., "001_") from counts colnames</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>counts_id <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^[0-9]+_"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(counts))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset metadata to only matched samples</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>metadata_matched <span class="ot">&lt;-</span> metadata[metadata<span class="sc">$</span>sample_id <span class="sc">%in%</span> counts_id, ]</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder metadata to match the order of counts</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>match_index <span class="ot">&lt;-</span> <span class="fu">match</span>(counts_id, metadata_matched<span class="sc">$</span>sample_id)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>metadata_aligned <span class="ot">&lt;-</span> metadata_matched[match_index, ]</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Align rownames</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(metadata_aligned) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(counts)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Final check</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">rownames</span>(metadata_aligned) <span class="sc">==</span> <span class="fu">colnames</span>(counts)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="principal-component-analysis-for-exploratory-data-visualization" class="level1">
<h1>3. Principal Component Analysis for Exploratory Data Visualization</h1>
<p>Principal component analysis was performed to explore patterns in gene expression and assess sample clustering based on experimental conditions and cell types. Multiple PCA plots were generated to identify potential batch effects and biological variability.</p>
<section id="pca-plot-highlighting-interferon-status" class="level2">
<h2 class="anchored" data-anchor-id="pca-plot-highlighting-interferon-status">3.1 PCA Plot Highlighting Interferon Status</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>metadata_aligned<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">factor</span>(metadata_aligned<span class="sc">$</span>ifn_status, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"HC"</span>, <span class="st">"IFNneg"</span>, <span class="st">"IFNpos"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colData =</span> metadata_aligned,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out low-count genes</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>smallestGroupSize <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> smallestGroupSize</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> dds[keep, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize and transform</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vsd, <span class="at">intgroup =</span> <span class="st">"ifn_status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pca-plot-highlighting-cell-type-specific-expression-patterns" class="level2">
<h2 class="anchored" data-anchor-id="pca-plot-highlighting-cell-type-specific-expression-patterns">3.2 PCA Plot Highlighting Cell Type-Specific Expression Patterns</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>metadata_aligned<span class="sc">$</span>cell_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(metadata_aligned<span class="sc">$</span>cell_type)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colData =</span> metadata_aligned,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> <span class="sc">~</span> cell_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>smallestGroupSize <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> smallestGroupSize</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> dds[keep, ]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vsd, <span class="at">intgroup =</span> <span class="st">"cell_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pca-plot-stratified-by-cell-type-and-disease-state" class="level2">
<h2 class="anchored" data-anchor-id="pca-plot-stratified-by-cell-type-and-disease-state">3.3 PCA Plot Stratified by Cell Type and Disease State</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>metadata_aligned<span class="sc">$</span>disease_state <span class="ot">&lt;-</span> <span class="fu">factor</span>(metadata_aligned<span class="sc">$</span>disease_state)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colData =</span> metadata_aligned,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> <span class="sc">~</span> cell_type <span class="sc">*</span> disease_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>smallestGroupSize <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> smallestGroupSize</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> dds[keep, ]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vsd, <span class="at">intgroup =</span> <span class="fu">c</span>(<span class="st">"cell_type"</span>, <span class="st">"disease_state"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pca-plot-stratified-by-cell-type-and-interferon-status" class="level2">
<h2 class="anchored" data-anchor-id="pca-plot-stratified-by-cell-type-and-interferon-status">3.3 PCA Plot Stratified by Cell Type and Interferon Status</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colData =</span> metadata_aligned,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> <span class="sc">~</span> cell_type <span class="sc">*</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>smallestGroupSize <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> smallestGroupSize</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> dds[keep, ]</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vsd, <span class="at">intgroup =</span> <span class="fu">c</span>(<span class="st">"cell_type"</span>, <span class="st">"ifn_status"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cell-type-specific-pca-plots-stratified-by-disease-state" class="level2">
<h2 class="anchored" data-anchor-id="cell-type-specific-pca-plots-stratified-by-disease-state">3.4 Cell Type-Specific PCA Plots Stratified by Disease State</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all cell types and generate PCA plots by disease_state</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>cell_types <span class="ot">&lt;-</span> <span class="fu">unique</span>(metadata_aligned<span class="sc">$</span>cell_type)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ct <span class="cf">in</span> cell_types) {</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Processing PCA for: "</span>, ct)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  meta_sub <span class="ot">&lt;-</span> metadata_aligned[metadata_aligned<span class="sc">$</span>cell_type <span class="sc">==</span> ct, ]</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  counts_sub <span class="ot">&lt;-</span> counts[, <span class="fu">rownames</span>(meta_sub)]</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  dds_sub <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts_sub,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colData =</span> meta_sub,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> <span class="sc">~</span> disease_state)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_sub) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  dds_sub <span class="ot">&lt;-</span> dds_sub[keep, ]</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  vsd_sub <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_sub, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plotPCA</span>(vsd_sub, <span class="at">intgroup =</span> <span class="st">"disease_state"</span>) <span class="sc">+</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"PCA for"</span>, ct))</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: T cells</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: B cells</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: PMN</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: cDC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: pDC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-12-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: cMo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-12-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="detecting-and-removing-outliers-using-local-outlier-factor-lof" class="level1">
<h1>4. Detecting and Removing Outliers using Local Outlier Factor (LOF)</h1>
<p>To improve accuracy in PCA space, we applied the Local Outlier Factor (LOF) algorithm to detect and exclude samples that deviate from the local density of their respective cell types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(<span class="fu">t</span>(<span class="fu">assay</span>(vsd)))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>pc_scores <span class="ot">&lt;-</span> pc<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># LOF calculation</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>lof_scores <span class="ot">&lt;-</span> <span class="fu">lof</span>(pc_scores, <span class="at">k =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in lof(pc_scores, k = 10): lof: k is now deprecated. use minPts = 11
instead .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lof_scores) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dds)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize LOF scores</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(lof_scores), <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">main =</span> <span class="st">"Sorted LOF Scores"</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"LOF Score"</span>, <span class="at">xlab =</span> <span class="st">"Sample Index"</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">quantile</span>(lof_scores, <span class="fl">0.995</span>), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a threshold</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lof_scores, <span class="fl">0.99</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">names</span>(lof_scores[lof_scores <span class="sc">&gt;</span> threshold])</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove outlier and replot</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>dds_clean <span class="ot">&lt;-</span> dds[, <span class="sc">!</span>(<span class="fu">colnames</span>(dds) <span class="sc">%in%</span> outliers)]</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>vsd_clean <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_clean, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA before cleaning</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>vsd_before <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>pca_before <span class="ot">&lt;-</span> <span class="fu">plotPCA</span>(vsd_before, <span class="at">intgroup =</span> <span class="st">"cell_type"</span>) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ggtitle</span>(<span class="st">"PCA Before Outlier Removal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA after cleaning</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>vsd_after <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_clean, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>pca_after <span class="ot">&lt;-</span> <span class="fu">plotPCA</span>(vsd_after, <span class="at">intgroup =</span> <span class="st">"cell_type"</span>) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">ggtitle</span>(<span class="st">"PCA After Outlier Removal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot side by side</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>pca_before <span class="sc">+</span> pca_after</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cell-type-specific-pca-plots-stratified-by-disease-state-1" class="level1">
<h1>5. Cell Type-Specific PCA Plots Stratified by Disease State</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all cell types and generate PCA plots by ifn_status</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>cell_types <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ct <span class="cf">in</span> cell_types) {</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Processing PCA for: "</span>, ct)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset cleaned dds object</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  dds_sub <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> ct]</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply minimal filtering (if needed)</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_sub) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  dds_sub <span class="ot">&lt;-</span> dds_sub[keep, ]</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use no design formula for PCA</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>  dds_sub <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> <span class="fu">counts</span>(dds_sub),</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colData =</span> <span class="fu">colData</span>(dds_sub),</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">design =</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform and PCA</span></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>  vsd_sub <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_sub, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plotPCA</span>(vsd_sub, <span class="at">intgroup =</span> <span class="st">"ifn_status"</span>) <span class="sc">+</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"PCA for"</span>, ct))</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: T cells</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: B cells
using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: PMN
using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: cDC
using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-14-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: pDC
using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-14-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing PCA for: cMo
using ntop=500 top features by variance</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-14-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Principal component analysis reveals disease-related clustering driven by the interferon response, with IFN-positive samples separating clearly from healthy controls and IFN-negative individuals. This indicates that IFN signaling contributes substantially to the transcriptional variability observed across different immune cell types in systemic lupus erythematosus.</p>
</section>
<section id="differential-expression-analysis" class="level1">
<h1>6. Differential Expression Analysis</h1>
<section id="differential-expression-analysis-for-ifnpos-vs-hc" class="level2">
<h2 class="anchored" data-anchor-id="differential-expression-analysis-for-ifnpos-vs-hc">6.1 Differential Expression Analysis for IFNpos vs HC</h2>
<p>In this section, we perform differential expression analysis to identify genes that are significantly differentially expressed between interferon-positive (IFNpos) patients and healthy controls (HC) across various immune cell types.</p>
<section id="differential-expression-analysis-for-cmo-cells-ifnpos-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-cmo-cells-ifnpos-vs-hc">6.1.1 Differential Expression Analysis for cMo Cells (IFNpos vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first cell type</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>cell_type_cMo <span class="ot">&lt;-</span> <span class="st">"cMo"</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the cleaned dataset for cMo cells</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>dds_cMo <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> cell_type_cMo]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep genes with enough reads</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>keep_cMo <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_cMo) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>dds_cMo <span class="ot">&lt;-</span> dds_cMo[keep_cMo, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new DESeqDataSet</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>cts_cMo <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds_cMo)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>coldata_cMo <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_cMo))</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set IFN status as factor with reference level HC</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>coldata_cMo<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_cMo<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"HC"</span>)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build new DESeq2 object</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>dds_cMo <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_cMo,</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_cMo,</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>dds_cMo <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_cMo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 673 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs HC</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>res_cMo <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_cMo, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"HC"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order and inspect</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>res_cMo <span class="ot">&lt;-</span> res_cMo[<span class="fu">order</span>(res_cMo<span class="sc">$</span>padj), ]</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_cMo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 23365 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 1049, 4.5%
LFC &lt; 0 (down)     : 666, 2.9%
outliers [1]       : 0, 0%
low counts [2]     : 1812, 7.8%
(mean count &lt; 2)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_cMo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI27     1601.10        8.16377  0.558304   14.6225 2.01987e-48 4.35344e-44
EIF2AK2   1371.42        1.60031  0.111775   14.3172 1.70912e-46 1.84184e-42
ISG15     2959.12        2.50801  0.177266   14.1483 1.91351e-45 1.37473e-41
IFI6      7850.30        2.69260  0.197190   13.6548 1.89012e-42 1.01844e-38
IFITM1    2738.47        2.89249  0.212503   13.6115 3.42048e-42 1.47443e-38
LY6E      6767.12        2.47251  0.186137   13.2833 2.89459e-40 1.03978e-36</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shrinkage to log2 fold changes</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>resLFC_cMo <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_cMo,</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_HC"</span>,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
</div>
<section id="exporting-results-for-cmo-cells" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-cmo-cells">6.1.1.1 Exporting results for cMo Cells</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>res_sig_cMo <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_cMo, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_cMo), <span class="at">file =</span> <span class="st">"results/DEG_significant_cMo_IFNpos_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes">6.1.1.2 MA-plot of shrunken log2 fold changes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_cMo, <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs HC in cMo"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-cmo-ifnpos-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-cmo-ifnpos-vs-hc">6.1.1.3 Top 10 Differentially Expressed Genes in cMo (IFNpos vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_cMo[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_cMo<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 10 rows and 6 columns
            baseMean log2FoldChange     lfcSE      stat      pvalue        padj
           &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI27     1601.09952        8.16377  0.558304  14.62245 2.01987e-48 4.35344e-44
OTOF       274.27434        6.67924  0.724277   9.22194 2.91779e-20 9.38615e-18
LINC00487    8.53610        5.87209  1.298883   4.52088 6.15841e-06 3.71799e-04
RBP4         5.27853        5.16154  1.160490   4.44772 8.67867e-06 4.98803e-04
MS4A1        4.09053        4.97487  1.686323   2.95013 3.17640e-03 5.35269e-02
KCNMA1       4.00869        4.63947  1.217596   3.81035 1.38771e-04 5.00992e-03
ADAMTS2     89.31312        4.26389  0.670728   6.35710 2.05604e-10 3.01454e-08
IGHG2        2.88288        4.17064  1.197272   3.48346 4.94985e-04 1.33532e-02
STAP1       15.04623        4.14981  0.980391   4.23281 2.30788e-05 1.14877e-03
NCAPGP1      2.96550        3.64041  1.370619   2.65603 7.90664e-03 9.95977e-02</code></pre>
</div>
</div>
</section>
<section id="volcano-plot" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot">6.1.1.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>res_df_cMo <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cMo)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>res_df_cMo<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cMo)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>res_df_cMo <span class="ot">&lt;-</span> res_df_cMo[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_cMo,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_cMo<span class="sc">$</span>gene,                </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,                  </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,                           </span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,                         </span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,                         </span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos vs HC in cMo'</span>,</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 1701 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-top-differentially-expressed-genes" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-of-top-differentially-expressed-genes">6.1.1.5 Heatmap of top differentially expressed genes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with vst (variance stabilizing transformation)</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>vsd_cMo <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_cMo, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract expression matrix</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>expr_mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd_cMo)</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 20 significant genes by padj</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>res_df_cMo <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cMo)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>res_df_cMo <span class="ot">&lt;-</span> res_df_cMo[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo<span class="sc">$</span>padj), ]</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>res_df_cMo<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cMo)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>top20_genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cMo[<span class="fu">order</span>(res_df_cMo<span class="sc">$</span>padj), ])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset expression matrix</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>mat_top20 <span class="ot">&lt;-</span> expr_mat[top20_genes, ]</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_cMo)[, <span class="st">"ifn_status"</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(mat_top20,</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno,</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>, </span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">8</span>,</span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"correlation"</span>,</span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"DE Genes in cMo (IFNpos vs HC)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-cdc-cells-ifnpos-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-cdc-cells-ifnpos-vs-hc">6.1.2 Differential Expression Analysis for cDC Cells (IFNpos vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first cell type</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>cell_type_cDC <span class="ot">&lt;-</span> <span class="st">"cDC"</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the cleaned dataset for cDC cells</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>dds_cDC <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> cell_type_cDC]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep genes with enough reads</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>keep_cDC <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_cDC) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>dds_cDC <span class="ot">&lt;-</span> dds_cDC[keep_cDC, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new DESeqDataSet</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>cts_cDC <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds_cDC)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>coldata_cDC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_cDC))</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set IFN status as factor with reference level HC</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>coldata_cDC<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_cDC<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"HC"</span>)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build new DESeq2 object</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>dds_cDC <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_cDC,</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_cDC,</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>dds_cDC <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_cDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 102 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs HC</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>res_cDC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_cDC, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"HC"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order and inspect</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>res_cDC <span class="ot">&lt;-</span> res_cDC[<span class="fu">order</span>(res_cDC<span class="sc">$</span>padj), ]</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_cDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 18625 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 1529, 8.2%
LFC &lt; 0 (down)     : 1310, 7%
outliers [1]       : 0, 0%
low counts [2]     : 2889, 16%
(mean count &lt; 9)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_cDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 6 rows and 6 columns
        baseMean log2FoldChange     lfcSE      stat      pvalue        padj
       &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFIT1    688.106        3.77915  0.293633   12.8703 6.61310e-38 1.04064e-33
IFITM1  3325.129        3.44492  0.271635   12.6822 7.42639e-37 5.84308e-33
ISG15   1460.197        3.05677  0.260789   11.7212 9.92123e-32 5.20401e-28
IFI6    2847.881        3.60185  0.311729   11.5544 7.01290e-31 2.75888e-27
IFI27   1272.994        9.01383  0.791256   11.3918 4.59382e-30 1.44577e-26
IFIT3   1268.449        3.89440  0.344651   11.2995 1.31915e-29 3.45970e-26</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shrinkage to log2 fold changes</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>resLFC_cDC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_cDC,</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_HC"</span>,</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
</div>
<section id="exporting-results-for-cdc-cells" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-cdc-cells">6.1.2.1 Exporting results for cDC Cells</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>res_sig_cDC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_cDC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_cDC), <span class="at">file =</span> <span class="st">"results/DEG_significant_cDC_IFNpos_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-1" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-1">6.1.2.2 MA-plot of shrunken log2 fold changes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_cDC, <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs HC in cDC"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-cdc-ifnpos-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-cdc-ifnpos-vs-hc">6.1.2.3 Top 10 Differentially Expressed Genes in cDC (IFNpos vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_cDC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_cDC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 10 rows and 6 columns
           baseMean log2FoldChange     lfcSE      stat      pvalue        padj
          &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IL36A     101.84935       14.28602  2.848197   5.01581 5.28103e-07 4.77599e-05
IFI27    1272.99387        9.01383  0.791256  11.39180 4.59382e-30 1.44577e-26
OTOF       50.04154        7.67626  1.401762   5.47615 4.34676e-08 5.56102e-06
IFI44L   1998.83463        5.09890  0.483852  10.53815 5.76208e-26 9.06721e-23
APOBEC3A  380.21260        4.97504  0.670576   7.41904 1.17969e-13 3.63991e-11
USP18     198.72203        4.64458  0.427297  10.86968 1.60759e-27 3.16213e-24
ETV7       43.93760        4.55012  0.722553   6.29728 3.02907e-10 6.11096e-08
USP41      31.90146        4.30186  0.476438   9.02922 1.72900e-19 1.29559e-16
TNFAIP6     9.92146        4.24865  0.888660   4.78096 1.74461e-06 1.26512e-04
IFIT3    1268.44887        3.89440  0.344651  11.29953 1.31915e-29 3.45970e-26</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-1" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-1">6.1.2.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>res_df_cDC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cDC)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>res_df_cDC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cDC)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>res_df_cDC <span class="ot">&lt;-</span> res_df_cDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_cDC,</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_cDC<span class="sc">$</span>gene,                </span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,                  </span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,                           </span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,                         </span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,                         </span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos vs HC in cDC'</span>,</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 2821 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-top-differentially-expressed-genes-1" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-of-top-differentially-expressed-genes-1">6.1.2.5 Heatmap of top differentially expressed genes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with vst (variance stabilizing transformation)</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>vsd_cDC <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_cDC, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract expression matrix</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>expr_mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd_cDC)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 20 significant genes by padj</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>res_df_cDC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cDC)</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>res_df_cDC <span class="ot">&lt;-</span> res_df_cDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC<span class="sc">$</span>padj), ]</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>res_df_cDC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cDC)</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>top20_genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cDC[<span class="fu">order</span>(res_df_cDC<span class="sc">$</span>padj), ])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset expression matrix</span></span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>mat_top20 <span class="ot">&lt;-</span> expr_mat[top20_genes, ]</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_cDC)[, <span class="st">"ifn_status"</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(mat_top20,</span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno,</span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>, </span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">8</span>,</span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"correlation"</span>,</span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"DE Genes in cDC (IFNpos vs HC)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-b-cells-ifnpos-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-b-cells-ifnpos-vs-hc">6.1.3 Differential Expression Analysis for B Cells (IFNpos vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first cell type</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>cell_type_B_Cells <span class="ot">&lt;-</span> <span class="st">"B cells"</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the cleaned dataset for cDC cells</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>dds_B_Cells <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> cell_type_B_Cells]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep genes with enough reads</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>keep_B_Cells <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_B_Cells) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>dds_B_Cells <span class="ot">&lt;-</span> dds_B_Cells[keep_B_Cells, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new DESeqDataSet</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>cts_B_Cells <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds_B_Cells)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>coldata_B_Cells <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_B_Cells))</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set IFN status as factor with reference level HC</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>coldata_B_Cells<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_B_Cells<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"HC"</span>)</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build new DESeq2 object</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>dds_B_Cells <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_B_Cells,</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_B_Cells,</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>dds_B_Cells <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_B_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 116 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs HC</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>res_B_Cells <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_B_Cells, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"HC"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order and inspect</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>res_B_Cells <span class="ot">&lt;-</span> res_B_Cells[<span class="fu">order</span>(res_B_Cells<span class="sc">$</span>padj), ]</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_B_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 20081 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 1422, 7.1%
LFC &lt; 0 (down)     : 730, 3.6%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 1)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_B_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 6 rows and 6 columns
        baseMean log2FoldChange     lfcSE      stat      pvalue        padj
       &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
CMPK2    168.043        3.81075  0.268312  14.20267 8.81859e-46 1.77086e-41
IFI44L  1479.816        4.58296  0.377188  12.15034 5.71290e-34 5.73604e-30
IFI44    536.649        3.91298  0.339869  11.51320 1.13204e-30 7.57750e-27
IFIT3    488.133        3.60142  0.314413  11.45441 2.23475e-30 1.12190e-26
RSAD2    187.138        3.90328  0.356874  10.93740 7.63618e-28 3.06684e-24
IFIT1    229.237        3.55396  0.361406   9.83371 8.05946e-23 2.69737e-19</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shrinkage to log2 fold changes</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>resLFC_B_Cells <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_B_Cells,</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_HC"</span>,</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
</div>
<section id="exporting-results-for-b-cells" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-b-cells">6.1.3.1 Exporting results for B Cells</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>res_sig_B_Cells <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_B_Cells, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_B_Cells), <span class="at">file =</span> <span class="st">"results/DEG_significant_B_Cells_IFNpos_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-2" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-2">6.1.3.2 MA-plot of shrunken log2 fold changes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_B_Cells, <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs HC in B Cells"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-b-cells-ifnpos-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-b-cells-ifnpos-vs-hc">6.1.3.3 Top 10 Differentially Expressed Genes in B Cells (IFNpos vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_B_Cells[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_B_Cells<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 10 rows and 6 columns
            baseMean log2FoldChange     lfcSE      stat      pvalue        padj
           &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI27      254.35770        7.73796  0.983877   7.86476 3.69797e-15 3.37541e-12
SIGLEC1     27.18012        7.02780  1.018920   6.89731 5.29980e-12 3.43308e-09
OTOF         6.11952        6.60454  1.717900   3.84455 1.20776e-04 7.43959e-03
CCL2         5.41444        6.08373  1.222757   4.97542 6.51062e-07 1.63425e-04
LINC00487    4.18743        5.77172  1.000063   5.77135 7.86367e-09 4.04898e-06
FRZB         5.14098       -4.73843  1.209170  -3.91875 8.90102e-05 6.10039e-03
VN1R105P     3.82649        4.61473  1.307863   3.52845 4.18000e-04 1.56569e-02
IFI44L    1479.81593        4.58296  0.377188  12.15034 5.71290e-34 5.73604e-30
GPR84        3.01661        4.21111  1.243101   3.38759 7.05101e-04 2.12600e-02
EMP1         5.84359        4.06424  0.843375   4.81901 1.44270e-06 3.29215e-04</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-2" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-2">6.1.3.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_B_Cells)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_B_Cells)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells <span class="ot">&lt;-</span> res_df_B_Cells[<span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_B_Cells,</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_B_Cells<span class="sc">$</span>gene,                </span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,                  </span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,                           </span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,                         </span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,                         </span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos vs HC in B Cells'</span>,</span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span></span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 2138 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-top-differentially-expressed-genes-2" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-of-top-differentially-expressed-genes-2">6.1.3.5 Heatmap of top differentially expressed genes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with vst (variance stabilizing transformation)</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>vsd_B_Cells <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_B_Cells, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract expression matrix</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>expr_mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd_B_Cells)</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 20 significant genes by padj</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_B_Cells)</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells <span class="ot">&lt;-</span> res_df_cDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells<span class="sc">$</span>padj), ]</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_B_Cells)</span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>top20_genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_B_Cells[<span class="fu">order</span>(res_df_B_Cells<span class="sc">$</span>padj), ])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset expression matrix</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>mat_top20 <span class="ot">&lt;-</span> expr_mat[top20_genes, ]</span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_B_Cells)[, <span class="st">"ifn_status"</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(mat_top20,</span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno,</span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>,  </span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">8</span>,</span>
<span id="cb187-24"><a href="#cb187-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb187-25"><a href="#cb187-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"correlation"</span>,</span>
<span id="cb187-26"><a href="#cb187-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"DE Genes in B Cells (IFNpos vs HC)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-t-cells-ifnpos-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-t-cells-ifnpos-vs-hc">6.1.4 Differential Expression Analysis for T Cells (IFNpos vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first cell type</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>cell_type_T_Cells <span class="ot">&lt;-</span> <span class="st">"T cells"</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the cleaned dataset for cDC cells</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>dds_T_Cells <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> cell_type_T_Cells]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep genes with enough reads</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>keep_T_Cells <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_T_Cells) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>dds_T_Cells <span class="ot">&lt;-</span> dds_T_Cells[keep_T_Cells, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new DESeqDataSet</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>cts_T_Cells <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds_T_Cells)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>coldata_T_Cells <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_T_Cells))</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set IFN status as factor with reference level HC</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>coldata_T_Cells<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_T_Cells<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"HC"</span>)</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build new DESeq2 object</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>dds_T_Cells <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_T_Cells,</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_T_Cells,</span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>dds_T_Cells <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_T_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 50 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs HC</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>res_T_Cells <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_T_Cells, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"HC"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order and inspect</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>res_T_Cells <span class="ot">&lt;-</span> res_T_Cells[<span class="fu">order</span>(res_T_Cells<span class="sc">$</span>padj), ]</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_T_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 20883 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 949, 4.5%
LFC &lt; 0 (down)     : 518, 2.5%
outliers [1]       : 0, 0%
low counts [2]     : 5264, 25%
(mean count &lt; 13)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_T_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 6 rows and 6 columns
        baseMean log2FoldChange     lfcSE      stat      pvalue        padj
       &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI6    2116.879        2.52368  0.200713   12.5736 2.95069e-36 4.60868e-32
OAS3     622.486        1.92040  0.165602   11.5965 4.29171e-31 3.35161e-27
IFI44L  2005.728        4.29735  0.376195   11.4232 3.20170e-30 1.66691e-26
IFI44   1137.650        2.71482  0.241037   11.2631 1.99666e-29 7.79645e-26
IFIT3    346.838        3.31500  0.305503   10.8510 1.97325e-27 6.16404e-24
OAS1     712.529        2.66137  0.245767   10.8288 2.51351e-27 6.54309e-24</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shrinkage to log2 fold changes</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>resLFC_T_Cells <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_T_Cells,</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_HC"</span>,</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
</div>
<section id="exporting-results-for-t-cells" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-t-cells">6.1.4.1 Exporting results for T Cells</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>res_sig_T_Cells <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_T_Cells, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_T_Cells), <span class="at">file =</span> <span class="st">"results/DEG_significant_T_Cells_IFNpos_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-3" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-3">6.1.4.2 MA-plot of shrunken log2 fold changes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_T_Cells, <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs HC in T Cells"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-t-cells-ifnpos-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-t-cells-ifnpos-vs-hc">6.1.4.3 Top 10 Differentially Expressed Genes in T Cells (IFNpos vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_T_Cells[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_T_Cells<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 10 rows and 6 columns
        baseMean log2FoldChange     lfcSE      stat      pvalue        padj
       &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI27   807.3096        7.04081  0.682009  10.32363 5.50986e-25 6.14704e-22
IFI44L 2005.7283        4.29735  0.376195  11.42321 3.20170e-30 1.66691e-26
OTOF     32.4095        3.54321  0.630762   5.61734 1.93922e-08 5.13369e-06
IFIT3   346.8381        3.31500  0.305503  10.85097 1.97325e-27 6.16404e-24
NRIR     15.4155        3.04216  0.373345   8.14839 3.68799e-16 1.74554e-13
USP41    59.5937        2.98922  0.282578  10.57839 3.75354e-26 6.51406e-23
RSAD2   345.9063        2.92321  0.285344  10.24454 1.25225e-24 1.30392e-21
CMPK2   205.6176        2.86353  0.266171  10.75825 5.41901e-27 1.20914e-23
USP18   376.3179        2.78829  0.273649  10.18928 2.21407e-24 2.16135e-21
IFIT1   267.1082        2.78112  0.262896  10.57880 3.73696e-26 6.51406e-23</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-3" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-3">6.1.4.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_T_Cells)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_T_Cells)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells <span class="ot">&lt;-</span> res_df_T_Cells[<span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_T_Cells,</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_T_Cells<span class="sc">$</span>gene,                </span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,                  </span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,                           </span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,                         </span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,                         </span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos vs HC in T Cells'</span>,</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 1453 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-top-differentially-expressed-genes-3" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-of-top-differentially-expressed-genes-3">6.1.4.5 Heatmap of top differentially expressed genes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with vst (variance stabilizing transformation)</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>vsd_T_Cells <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_T_Cells, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract expression matrix</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>expr_mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd_T_Cells)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 20 significant genes by padj</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_T_Cells)</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells <span class="ot">&lt;-</span> res_df_cDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells<span class="sc">$</span>padj), ]</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_T_Cells)</span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>top20_genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_T_Cells[<span class="fu">order</span>(res_df_T_Cells<span class="sc">$</span>padj), ])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset expression matrix</span></span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>mat_top20 <span class="ot">&lt;-</span> expr_mat[top20_genes, ]</span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_T_Cells)[, <span class="st">"ifn_status"</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(mat_top20,</span>
<span id="cb214-21"><a href="#cb214-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno,</span>
<span id="cb214-22"><a href="#cb214-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>,  </span>
<span id="cb214-23"><a href="#cb214-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">8</span>,</span>
<span id="cb214-24"><a href="#cb214-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb214-25"><a href="#cb214-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"correlation"</span>,</span>
<span id="cb214-26"><a href="#cb214-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"DE Genes in T Cells (IFNpos vs HC)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-pdc-ifnpos-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-pdc-ifnpos-vs-hc">6.1.5 Differential Expression Analysis for pDC (IFNpos vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first cell type</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>cell_type_pDC <span class="ot">&lt;-</span> <span class="st">"pDC"</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the cleaned dataset for pDC cells</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>dds_pDC <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> cell_type_pDC]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep genes with enough reads</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>keep_pDC <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_pDC) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>dds_pDC <span class="ot">&lt;-</span> dds_pDC[keep_pDC, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new DESeqDataSet</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>cts_pDC <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds_pDC)</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>coldata_pDC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_pDC))</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set IFN status as factor with reference level HC</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>coldata_pDC<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_pDC<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"HC"</span>)</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build new DESeq2 object</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>dds_pDC <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_pDC,</span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_pDC,</span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>dds_pDC <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_pDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 78 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs HC</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>res_pDC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_pDC, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"HC"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order and inspect</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>res_pDC <span class="ot">&lt;-</span> res_pDC[<span class="fu">order</span>(res_pDC<span class="sc">$</span>padj), ]</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_pDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 19119 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 454, 2.4%
LFC &lt; 0 (down)     : 354, 1.9%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 0)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_pDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
PARP14   419.5817        3.57201  0.289372   12.3440 5.24719e-35 1.00321e-30
TNFSF10  197.4279        3.06011  0.258398   11.8426 2.35051e-32 2.24697e-28
STAT1   4832.2032        1.95411  0.186362   10.4855 1.00674e-25 6.41594e-22
EIF2AK2 1075.8132        2.18572  0.212010   10.3095 6.38506e-25 2.03460e-21
IFI27    245.1479        7.50725  0.727046   10.3257 5.39294e-25 2.03460e-21
RSAD2     84.3289        3.98667  0.385998   10.3282 5.25159e-25 2.03460e-21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shrinkage to log2 fold changes</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>resLFC_pDC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_pDC,</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_HC"</span>,</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
</div>
<section id="exporting-results-for-pdc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-pdc">6.1.5.1 Exporting results for pDC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>res_sig_pDC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_pDC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_pDC), <span class="at">file =</span> <span class="st">"results/DEG_significant_pDC_IFNpos_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-4" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-4">6.1.5.2 MA-plot of shrunken log2 fold changes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_pDC, <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs HC in pDC"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-pdc-ifnpos-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-pdc-ifnpos-vs-hc">6.1.5.3 Top 10 Differentially Expressed Genes in pDC (IFNpos vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_pDC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_pDC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 10 rows and 6 columns
              baseMean log2FoldChange     lfcSE      stat      pvalue
             &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
IL36A        200.67437       10.01732  1.730896   5.78736 7.15002e-09
IFI27        245.14788        7.50725  0.727046  10.32569 5.39294e-25
C1GALT1P3      5.44997        5.65935  1.894706   2.98693 2.81796e-03
USP18        410.60234        5.12661  0.587139   8.73152 2.51274e-18
USP41         67.68563        4.98772  0.580768   8.58815 8.83797e-18
AC005780.1     4.00141       -4.97312  1.045627  -4.75611 1.97356e-06
KDM5D         23.26211        4.97233  0.914887   5.43491 5.48231e-08
LGALS3BP      69.19806        4.94647  0.531916   9.29935 1.41312e-20
NRIR           9.60052        4.73858  0.782365   6.05674 1.38905e-09
RP11-640L9.2   2.43023        4.64686  1.057428   4.39449 1.11034e-05
                    padj
               &lt;numeric&gt;
IL36A        1.64700e-06
IFI27        2.03460e-21
C1GALT1P3    7.90704e-02
USP18        2.40205e-15
USP41        7.68060e-15
AC005780.1   2.45016e-04
KDM5D        1.04816e-05
LGALS3BP     2.25145e-17
NRIR         3.84889e-07
RP11-640L9.2 1.12321e-03</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-4" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-4">6.1.5.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>res_df_pDC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_pDC)</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>res_df_pDC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_pDC)</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>res_df_pDC <span class="ot">&lt;-</span> res_df_pDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_pDC,</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_pDC<span class="sc">$</span>gene,                </span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,                  </span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,                           </span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,                         </span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,                         </span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos vs HC in pDC'</span>,</span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb239-14"><a href="#cb239-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb239-15"><a href="#cb239-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb239-16"><a href="#cb239-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb239-17"><a href="#cb239-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb239-18"><a href="#cb239-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb239-19"><a href="#cb239-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb239-20"><a href="#cb239-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb239-21"><a href="#cb239-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb239-22"><a href="#cb239-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb239-23"><a href="#cb239-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb239-24"><a href="#cb239-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span></span>
<span id="cb239-25"><a href="#cb239-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 787 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-top-differentially-expressed-genes-4" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-of-top-differentially-expressed-genes-4">6.1.5.5 Heatmap of top differentially expressed genes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with vst (variance stabilizing transformation)</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>vsd_pDC <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_pDC, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract expression matrix</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>expr_mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd_pDC)</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 20 significant genes by padj</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>res_df_pDC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_pDC)</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>res_df_pDC <span class="ot">&lt;-</span> res_df_cDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC<span class="sc">$</span>padj), ]</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>res_df_pDC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_pDC)</span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>top20_genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_pDC[<span class="fu">order</span>(res_df_pDC<span class="sc">$</span>padj), ])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset expression matrix</span></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>mat_top20 <span class="ot">&lt;-</span> expr_mat[top20_genes, ]</span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_pDC)[, <span class="st">"ifn_status"</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(mat_top20,</span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno,</span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>,  </span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">8</span>,</span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"correlation"</span>,</span>
<span id="cb241-26"><a href="#cb241-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"DE Genes in pDC (IFNpos vs HC)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-pmn-ifnpos-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-pmn-ifnpos-vs-hc">6.1.6 Differential Expression Analysis for PMN (IFNpos vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first cell type</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>cell_type_PMN <span class="ot">&lt;-</span> <span class="st">"PMN"</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the cleaned dataset for PMN cells</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>dds_PMN <span class="ot">&lt;-</span> dds_clean[, <span class="fu">colData</span>(dds_clean)<span class="sc">$</span>cell_type <span class="sc">==</span> cell_type_PMN]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep genes with enough reads</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>keep_PMN <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds_PMN) <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>dds_PMN <span class="ot">&lt;-</span> dds_PMN[keep_PMN, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new DESeqDataSet</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>cts_PMN <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds_PMN)</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>coldata_PMN <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_PMN))</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set IFN status as factor with reference level HC</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>coldata_PMN<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_PMN<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"HC"</span>)</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build new DESeq2 object</span></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>dds_PMN <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_PMN,</span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_PMN,</span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>dds_PMN <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_PMN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 230 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs HC</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>res_PMN <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_PMN, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"HC"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order and inspect</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>res_PMN <span class="ot">&lt;-</span> res_PMN[<span class="fu">order</span>(res_PMN<span class="sc">$</span>padj), ]</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_PMN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 17241 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 1333, 7.7%
LFC &lt; 0 (down)     : 1212, 7%
outliers [1]       : 0, 0%
low counts [2]     : 335, 1.9%
(mean count &lt; 3)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_PMN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
SPATS2L   283.842        4.89608  0.386544   12.6663 9.08962e-37 1.53669e-32
IFIT3   26824.278        3.72780  0.300865   12.3903 2.95049e-35 1.66270e-31
IRF7     2198.851        2.46721  0.199080   12.3930 2.85016e-35 1.66270e-31
PARP14   2981.760        2.48630  0.202578   12.2733 1.26063e-34 5.32805e-31
TMEM123  4779.615        2.22638  0.187922   11.8474 2.22082e-32 7.50904e-29
CHMP5    1993.580        1.74595  0.147942   11.8016 3.83169e-32 1.07964e-28</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shrinkage to log2 fold changes</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>resLFC_PMN <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_PMN,</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_HC"</span>,</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
</div>
<section id="exporting-results-for-pmn" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-pmn">6.1.6.1 Exporting results for PMN</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>res_sig_PMN <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_PMN, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_PMN), <span class="at">file =</span> <span class="st">"results/DEG_significant_PMN_IFNpos_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-5" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-5">6.1.6.2 MA-plot of shrunken log2 fold changes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_PMN, <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs HC in PMN"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-pmn-ifnpos-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-pmn-ifnpos-vs-hc">6.1.6.3 Top 10 Differentially Expressed Genes in PMN (IFNpos vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_PMN[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_PMN<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs HC 
Wald test p-value: ifn status IFNpos vs HC 
DataFrame with 10 rows and 6 columns
                baseMean log2FoldChange     lfcSE      stat      pvalue
               &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
OTOF           130.96602       10.98273  1.010050  10.87345 1.54248e-27
IFI27          317.09943        9.62776  0.909950  10.58055 3.66817e-26
SIGLEC1         61.42598        8.34894  0.898786   9.28913 1.55557e-20
LY6E          9047.49266        6.81384  0.650138  10.48060 1.06067e-25
RP11-288L9.1     7.14567        6.53839  0.900625   7.25984 3.87544e-13
IFI44L        3549.05385        5.96718  0.645829   9.23956 2.47508e-20
USP18          423.57521        5.72042  0.781464   7.32012 2.47744e-13
HESX1            2.83300        5.64466  1.499583   3.76415 1.67114e-04
RSAD2        11379.20506        5.61395  0.543520  10.32887 5.21700e-25
OAS2          1926.24454        5.57061  0.671548   8.29518 1.08418e-16
                    padj
               &lt;numeric&gt;
OTOF         2.17310e-24
IFI27        3.87588e-23
SIGLEC1      5.25969e-18
LY6E         9.43775e-23
RP11-288L9.1 5.32668e-11
IFI44L       7.89504e-18
USP18        3.51963e-11
HESX1        3.31212e-03
RSAD2        3.67494e-22
OAS2         2.32015e-14</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-5" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-5">6.1.6.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>res_df_PMN <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_PMN)</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>res_df_PMN<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_PMN)</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>res_df_PMN <span class="ot">&lt;-</span> res_df_pDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_PMN,</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_PMN<span class="sc">$</span>gene,                </span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,                  </span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,                           </span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,                         </span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,                         </span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos vs HC in PMN'</span>,</span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb266-21"><a href="#cb266-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb266-22"><a href="#cb266-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb266-23"><a href="#cb266-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb266-24"><a href="#cb266-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span></span>
<span id="cb266-25"><a href="#cb266-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 2776 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-top-differentially-expressed-genes-5" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-of-top-differentially-expressed-genes-5">6.1.6.5 Heatmap of top differentially expressed genes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with vst (variance stabilizing transformation)</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>vsd_PMN <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds_PMN, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract expression matrix</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>expr_mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd_PMN)</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 20 significant genes by padj</span></span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>res_df_PMN <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_PMN)</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a>res_df_PMN <span class="ot">&lt;-</span> res_df_cDC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN<span class="sc">$</span>padj), ]</span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a>res_df_PMN<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_PMN)</span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-12"><a href="#cb268-12" aria-hidden="true" tabindex="-1"></a>top20_genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_pDC[<span class="fu">order</span>(res_df_pDC<span class="sc">$</span>padj), ])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb268-13"><a href="#cb268-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-14"><a href="#cb268-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset expression matrix</span></span>
<span id="cb268-15"><a href="#cb268-15" aria-hidden="true" tabindex="-1"></a>mat_top20 <span class="ot">&lt;-</span> expr_mat[top20_genes, ]</span>
<span id="cb268-16"><a href="#cb268-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-17"><a href="#cb268-17" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds_PMN)[, <span class="st">"ifn_status"</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb268-18"><a href="#cb268-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-19"><a href="#cb268-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb268-20"><a href="#cb268-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(mat_top20,</span>
<span id="cb268-21"><a href="#cb268-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno,</span>
<span id="cb268-22"><a href="#cb268-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>, </span>
<span id="cb268-23"><a href="#cb268-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">8</span>,</span>
<span id="cb268-24"><a href="#cb268-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb268-25"><a href="#cb268-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"correlation"</span>,</span>
<span id="cb268-26"><a href="#cb268-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"DE Genes in PMN (IFNpos vs HC)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="differential-expression-analysis-for-ifnneg-vs-hc" class="level2">
<h2 class="anchored" data-anchor-id="differential-expression-analysis-for-ifnneg-vs-hc">6.2 Differential Expression Analysis for IFNneg vs HC</h2>
<p>In this section, we perform differential expression analysis to identify genes that are significantly differentially expressed between interferon-negative (IFNpos) patients and healthy controls (HC) across various immune cell types.</p>
<section id="differential-expression-analysis-for-cmo-cells-ifnneg-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-cmo-cells-ifnneg-vs-hc">6.2.1 Differential Expression Analysis for cMo Cells (IFNneg vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNneg vs HC</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>res_cMo_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_cMo, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNneg"</span>, <span class="st">"HC"</span>))</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a>res_cMo_IFNneg_vs_HC <span class="ot">&lt;-</span> res_cMo_IFNneg_vs_HC[<span class="fu">order</span>(res_cMo_IFNneg_vs_HC<span class="sc">$</span>padj), ]</span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_cMo_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 23365 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 18, 0.077%
LFC &lt; 0 (down)     : 13, 0.056%
outliers [1]       : 0, 0%
low counts [2]     : 1359, 5.8%
(mean count &lt; 2)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_cMo_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue       padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;  &lt;numeric&gt;
ADAMTS2   89.3131       3.386145 0.6352283   5.33060 9.78913e-08 0.00215420
MYADM   1989.5331       0.561328 0.1136306   4.93994 7.81479e-07 0.00859861
DUSP6   7530.3104       0.636587 0.1328501   4.79177 1.65318e-06 0.00987081
EIF1B    825.8077       0.374432 0.0784099   4.77532 1.79420e-06 0.00987081
IGF2R    540.6360       0.442790 0.0966145   4.58306 4.58220e-06 0.02016719
MIR24-2  427.3148       0.901304 0.2004823   4.49568 6.93478e-06 0.02269228</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>resLFC_cMo_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_cMo,</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNneg_vs_HC"</span>, </span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>res_sig_cMo_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_cMo_IFNneg_vs_HC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-cmo-cells-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-cmo-cells-ifnneg-vs-hc">6.2.1.1 Exporting results for cMo Cells (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_cMo_IFNneg_vs_HC), </span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_cMo_IFNneg_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc">6.2.1.2 MA-plot of shrunken log2 fold changes (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_cMo_IFNneg_vs_HC,</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNneg vs HC in cMo"</span>,</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-cmo-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-cmo-ifnneg-vs-hc">6.2.1.3 Top 10 Differentially Expressed Genes in cMo (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_cMo_IFNneg_vs_HC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_cMo_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 10 rows and 6 columns
              baseMean log2FoldChange     lfcSE      stat      pvalue      padj
             &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt; &lt;numeric&gt;
ADAMTS2       89.31312       3.386145  0.635228   5.33060 9.78913e-08 0.0021542
PPP2R2B        2.25227       2.120025  0.554835   3.82100 1.32910e-04 0.0991050
GRAMD1C        6.23128       1.740362  0.411890   4.22531 2.38612e-05 0.0350060
FAM229B        2.18830      -1.643765  0.391445  -4.19923 2.67828e-05 0.0368363
RN7SL368P     29.12953      -1.186529  0.283916  -4.17916 2.92586e-05 0.0378743
RBKS          55.43416      -1.147650  0.257338  -4.45969 8.20779e-06 0.0226923
RP5-858L17.1   9.82502       1.146711  0.296603   3.86614 1.10570e-04 0.0935845
MTCO1P40     709.82125      -1.007199  0.235038  -4.28526 1.82523e-05 0.0334717
MIR24-2      427.31476       0.901304  0.200482   4.49568 6.93478e-06 0.0226923
RHOB         540.48661      -0.851456  0.223072  -3.81696 1.35106e-04 0.0991050</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-6" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-6">6.2.1.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>res_df_cMo_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cMo_IFNneg_vs_HC)</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>res_df_cMo_IFNneg_vs_HC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cMo_IFNneg_vs_HC)</span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>res_df_cMo_IFNneg_vs_HC <span class="ot">&lt;-</span> res_df_cMo_IFNneg_vs_HC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo_IFNneg_vs_HC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_cMo_IFNneg_vs_HC,</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_cMo_IFNneg_vs_HC<span class="sc">$</span>gene,</span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNneg vs HC in cMo'</span>,</span>
<span id="cb280-13"><a href="#cb280-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb280-14"><a href="#cb280-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb280-15"><a href="#cb280-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb280-16"><a href="#cb280-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb280-17"><a href="#cb280-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb280-18"><a href="#cb280-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb280-19"><a href="#cb280-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb280-20"><a href="#cb280-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb280-21"><a href="#cb280-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb280-22"><a href="#cb280-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb280-23"><a href="#cb280-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb280-24"><a href="#cb280-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 21 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-cdc-cells-ifnneg-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-cdc-cells-ifnneg-vs-hc">6.2.2 Differential Expression Analysis for cDC Cells (IFNneg vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNneg vs HC</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>res_cDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_cDC, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNneg"</span>, <span class="st">"HC"</span>))</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>res_cDC_IFNneg_vs_HC <span class="ot">&lt;-</span> res_cDC_IFNneg_vs_HC[<span class="fu">order</span>(res_cDC_IFNneg_vs_HC<span class="sc">$</span>padj), ]</span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_cDC_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 18625 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 35, 0.19%
LFC &lt; 0 (down)     : 93, 0.5%
outliers [1]       : 0, 0%
low counts [2]     : 13721, 74%
(mean count &lt; 293)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_cDC_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 6 rows and 6 columns
          baseMean log2FoldChange     lfcSE      stat      pvalue      padj
         &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt; &lt;numeric&gt;
TMEM261    295.942       0.455627 0.1028862   4.42845 9.49123e-06 0.0232725
TOMM22    1077.611       0.261988 0.0581670   4.50407 6.66646e-06 0.0232725
TLK1       831.273      -0.459340 0.1091860  -4.20695 2.58842e-05 0.0317341
TOB1      2263.746      -0.761976 0.1785421  -4.26776 1.97442e-05 0.0317341
ATXN7L3B   710.407      -0.383541 0.0960882  -3.99155 6.56437e-05 0.0366542
BCL11A     802.557      -0.558920 0.1404910  -3.97833 6.94005e-05 0.0366542</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>resLFC_cDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_cDC,</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNneg_vs_HC"</span>, </span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>res_sig_cDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_cDC_IFNneg_vs_HC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-cdc-cells-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-cdc-cells-ifnneg-vs-hc">6.2.2.1 Exporting results for cDC Cells (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_cDC_IFNneg_vs_HC), </span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_cDC_IFNneg_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-1" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-1">6.2.2.2 MA-plot of shrunken log2 fold changes (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_cDC_IFNneg_vs_HC,</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNneg vs HC in cDC"</span>,</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-cdc-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-cdc-ifnneg-vs-hc">6.2.2.3 Top 10 Differentially Expressed Genes in cDC (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_cDC_IFNneg_vs_HC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_cDC_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 10 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue      padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt; &lt;numeric&gt;
TAPBP    3228.650      -0.783863  0.192403  -4.07407 4.61981e-05 0.0366542
TOB1     2263.746      -0.761976  0.178542  -4.26776 1.97442e-05 0.0317341
ETS2     1841.674      -0.714411  0.177141  -4.03301 5.50674e-05 0.0366542
EIF4G1    747.102      -0.691823  0.202212  -3.42128 6.23263e-04 0.0795757
THEMIS2  2898.306      -0.682240  0.172254  -3.96066 7.47435e-05 0.0366542
CD52     6427.546       0.667926  0.220819   3.02477 2.48824e-03 0.0995194
BRD3      329.014      -0.653534  0.171489  -3.81094 1.38437e-04 0.0473017
SEMA4A   2661.197      -0.636192  0.166189  -3.82813 1.29123e-04 0.0473017
ARHGAP1   688.056      -0.611019  0.186027  -3.28457 1.02136e-03 0.0902210
PLBD2     394.616      -0.604826  0.200633  -3.01459 2.57330e-03 0.0995194</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-7" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-7">6.2.2.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>res_df_cDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cDC_IFNneg_vs_HC)</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>res_df_cDC_IFNneg_vs_HC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cDC_IFNneg_vs_HC)</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>res_df_cDC_IFNneg_vs_HC <span class="ot">&lt;-</span> res_df_cDC_IFNneg_vs_HC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC_IFNneg_vs_HC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_cDC_IFNneg_vs_HC,</span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_cDC_IFNneg_vs_HC<span class="sc">$</span>gene,</span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb293-10"><a href="#cb293-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb293-11"><a href="#cb293-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb293-12"><a href="#cb293-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNneg vs HC in cDC'</span>,</span>
<span id="cb293-13"><a href="#cb293-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb293-14"><a href="#cb293-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb293-15"><a href="#cb293-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb293-16"><a href="#cb293-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb293-17"><a href="#cb293-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb293-18"><a href="#cb293-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb293-19"><a href="#cb293-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb293-20"><a href="#cb293-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb293-21"><a href="#cb293-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb293-22"><a href="#cb293-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb293-23"><a href="#cb293-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb293-24"><a href="#cb293-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 127 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-b-cells-ifnneg-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-b-cells-ifnneg-vs-hc">6.2.3 Differential Expression Analysis for B Cells (IFNneg vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNneg vs HC</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>res_B_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_B_Cells, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNneg"</span>, <span class="st">"HC"</span>))</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>res_B_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> res_B_Cells_IFNneg_vs_HC[<span class="fu">order</span>(res_B_Cells_IFNneg_vs_HC<span class="sc">$</span>padj), ]</span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_B_Cells_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 20081 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 47, 0.23%
LFC &lt; 0 (down)     : 6, 0.03%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 1)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_B_Cells_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 6 rows and 6 columns
          baseMean log2FoldChange     lfcSE      stat      pvalue        padj
         &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
GSTM1      54.6197       3.283811  0.353131   9.29913 1.41593e-20 2.84333e-16
GSTM2      80.3298       1.079795  0.193765   5.57271 2.50810e-08 2.51826e-04
GPAT3      23.1154       2.839002  0.558383   5.08433 3.68921e-07 2.46943e-03
ATP6V0E2  167.4293      -0.718782  0.153367  -4.68669 2.77663e-06 1.39394e-02
GIMAP7    119.6212       2.170722  0.469727   4.62125 3.81443e-06 1.53195e-02
PLEKHG3    18.0420       1.363192  0.298479   4.56713 4.94449e-06 1.65484e-02</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>resLFC_B_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_B_Cells,</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNneg_vs_HC"</span>, </span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>res_sig_B_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_B_Cells_IFNneg_vs_HC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-b-cells-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-b-cells-ifnneg-vs-hc">6.2.3.1 Exporting results for B Cells (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_B_Cells_IFNneg_vs_HC), </span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_B_Cells_IFNneg_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-2" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-2">6.2.3.2 MA-plot of shrunken log2 fold changes (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_B_Cells_IFNneg_vs_HC,</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNneg vs HC in B Cells"</span>,</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-b-cells-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-b-cells-ifnneg-vs-hc">6.2.3.3 Top 10 Differentially Expressed Genes in B Cells (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_B_Cells_IFNneg_vs_HC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_B_Cells_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 10 rows and 6 columns
          baseMean log2FoldChange     lfcSE      stat      pvalue        padj
         &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IL36A    117.48979       11.48314  2.670188   4.30050 1.70414e-05 3.42207e-02
STON2      3.79581        4.43217  1.111532   3.98745 6.67882e-05 6.61849e-02
DLEU7      3.39385        4.17314  1.057640   3.94571 7.95628e-05 6.61849e-02
SEMA3C     7.84296        3.46105  0.781083   4.43109 9.37595e-06 2.40427e-02
LGALS12    8.39750        3.31158  0.876472   3.77831 1.57898e-04 8.56961e-02
GSTM1     54.61974        3.28381  0.353131   9.29913 1.41593e-20 2.84333e-16
ARHGAP10   7.00551        3.00616  0.770506   3.90154 9.55809e-05 6.61849e-02
CES1      46.74957        2.98888  0.777640   3.84353 1.21278e-04 7.85610e-02
GPAT3     23.11542        2.83900  0.558383   5.08433 3.68921e-07 2.46943e-03
FRMD4B     8.42800        2.72120  0.713018   3.81646 1.35381e-04 8.23181e-02</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-8" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-8">6.2.3.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_B_Cells_IFNneg_vs_HC)</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells_IFNneg_vs_HC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_B_Cells_IFNneg_vs_HC)</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> res_df_B_Cells_IFNneg_vs_HC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells_IFNneg_vs_HC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_B_Cells_IFNneg_vs_HC,</span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_B_Cells_IFNneg_vs_HC<span class="sc">$</span>gene,</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNneg vs HC in B Cells'</span>,</span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb306-17"><a href="#cb306-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb306-18"><a href="#cb306-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb306-19"><a href="#cb306-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb306-20"><a href="#cb306-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb306-21"><a href="#cb306-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb306-22"><a href="#cb306-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb306-23"><a href="#cb306-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb306-24"><a href="#cb306-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 48 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-t-cells-ifnneg-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-t-cells-ifnneg-vs-hc">6.2.4 Differential Expression Analysis for T Cells (IFNneg vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNneg vs HC</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>res_T_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_T_Cells, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNneg"</span>, <span class="st">"HC"</span>))</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>res_T_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> res_T_Cells_IFNneg_vs_HC[<span class="fu">order</span>(res_T_Cells_IFNneg_vs_HC<span class="sc">$</span>padj), ]</span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_T_Cells_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 20883 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 2, 0.0096%
LFC &lt; 0 (down)     : 2, 0.0096%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 1)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_T_Cells_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 6 rows and 6 columns
                baseMean log2FoldChange     lfcSE      stat      pvalue
               &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
GSTM1          120.05630       3.238239  0.461119   7.02256 2.17836e-12
NLGN3           13.38667      -1.594066  0.315134  -5.05837 4.22861e-07
GSTM5           13.22514       1.829950  0.367661   4.97727 6.44875e-07
XX-FW83563B9.5  46.19150      -0.801303  0.167044  -4.79695 1.61102e-06
CNTF             3.21368       3.710791  0.918041   4.04207 5.29804e-05
DHCR24          97.38596      -1.022439  0.256845  -3.98076 6.86941e-05
                      padj
                 &lt;numeric&gt;
GSTM1          4.54906e-08
NLGN3          4.41530e-03
GSTM5          4.48898e-03
XX-FW83563B9.5 8.41072e-03
CNTF           2.21278e-01
DHCR24         2.39090e-01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>resLFC_T_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_T_Cells,</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNneg_vs_HC"</span>, </span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nbinomGLM(x = x, Y = YNZ, size = size, weights = weightsNZ, offset =
offsetNZ, : the line search routine failed, unable to sufficiently decrease the
function value
Warning in nbinomGLM(x = x, Y = YNZ, size = size, weights = weightsNZ, offset =
offsetNZ, : the line search routine failed, unable to sufficiently decrease the
function value</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nbinomGLM(x = x, Y = YNZ, size = size, weights = weightsNZ, offset =
offsetNZ, : the line search routine failed, unable to sufficiently decrease the
function value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>res_sig_T_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_T_Cells_IFNneg_vs_HC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-t-cells-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-t-cells-ifnneg-vs-hc">6.2.4.1 Exporting results for T Cells (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_T_Cells_IFNneg_vs_HC), </span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_T_Cells_IFNneg_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-3" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-3">6.2.4.2 MA-plot of shrunken log2 fold changes (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_T_Cells_IFNneg_vs_HC,</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNneg vs HC in T Cells"</span>,</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-t-cells-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-t-cells-ifnneg-vs-hc">6.2.4.3 Top 10 Differentially Expressed Genes in T Cells (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_T_Cells_IFNneg_vs_HC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_T_Cells_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 4 rows and 6 columns
                baseMean log2FoldChange     lfcSE      stat      pvalue
               &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
GSTM1           120.0563       3.238239  0.461119   7.02256 2.17836e-12
GSTM5            13.2251       1.829950  0.367661   4.97727 6.44875e-07
NLGN3            13.3867      -1.594066  0.315134  -5.05837 4.22861e-07
XX-FW83563B9.5   46.1915      -0.801303  0.167044  -4.79695 1.61102e-06
                      padj
                 &lt;numeric&gt;
GSTM1          4.54906e-08
GSTM5          4.48898e-03
NLGN3          4.41530e-03
XX-FW83563B9.5 8.41072e-03</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-9" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-9">6.2.4.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_T_Cells_IFNneg_vs_HC)</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells_IFNneg_vs_HC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_T_Cells_IFNneg_vs_HC)</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells_IFNneg_vs_HC <span class="ot">&lt;-</span> res_df_T_Cells_IFNneg_vs_HC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells_IFNneg_vs_HC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_T_Cells_IFNneg_vs_HC,</span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_T_Cells_IFNneg_vs_HC<span class="sc">$</span>gene,</span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNneg vs HC in T Cells'</span>,</span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb321-14"><a href="#cb321-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb321-15"><a href="#cb321-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb321-16"><a href="#cb321-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb321-17"><a href="#cb321-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb321-18"><a href="#cb321-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb321-19"><a href="#cb321-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb321-20"><a href="#cb321-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb321-21"><a href="#cb321-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb321-22"><a href="#cb321-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb321-23"><a href="#cb321-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb321-24"><a href="#cb321-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-pdc-ifnneg-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-pdc-ifnneg-vs-hc">6.2.5 Differential Expression Analysis for pDC (IFNneg vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNneg vs HC</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>res_pDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_pDC, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNneg"</span>, <span class="st">"HC"</span>))</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>res_pDC_IFNneg_vs_HC <span class="ot">&lt;-</span> res_pDC_IFNneg_vs_HC[<span class="fu">order</span>(res_pDC_IFNneg_vs_HC<span class="sc">$</span>padj), ]</span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_pDC_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 19119 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 31, 0.16%
LFC &lt; 0 (down)     : 75, 0.39%
outliers [1]       : 0, 0%
low counts [2]     : 4819, 25%
(mean count &lt; 13)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_pDC_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 6 rows and 6 columns
          baseMean log2FoldChange     lfcSE      stat      pvalue        padj
         &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
GSTM1     161.8400       3.008596 0.4752542   6.33050 2.44372e-10 3.49452e-06
IL36A     200.6744      10.618429 1.7308252   6.13489 8.52161e-10 6.09295e-06
ADGRL1     16.1937      -2.781083 0.5797667  -4.79690 1.61140e-06 7.68102e-03
CDC42EP3   31.7573       1.647111 0.3721727   4.42566 9.61463e-06 2.69092e-02
CSF3R     108.4947       1.154150 0.2703152   4.26965 1.95783e-05 2.69092e-02
EEF2     1535.5608      -0.414938 0.0960719  -4.31903 1.56713e-05 2.69092e-02</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>resLFC_pDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_pDC,</span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNneg_vs_HC"</span>, </span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>res_sig_pDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_pDC_IFNneg_vs_HC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-pdc-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-pdc-ifnneg-vs-hc">6.2.5.1 Exporting results for pDC (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_pDC_IFNneg_vs_HC), </span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_pDC_IFNneg_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-4" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-4">6.2.5.2 MA-plot of shrunken log2 fold changes (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_pDC_IFNneg_vs_HC,</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNneg vs HC in pDC"</span>,</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-pdc-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-pdc-ifnneg-vs-hc">6.2.5.3 Top 10 Differentially Expressed Genes in pDC (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_pDC_IFNneg_vs_HC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_pDC_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 10 rows and 6 columns
        baseMean log2FoldChange     lfcSE      stat      pvalue        padj
       &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IL36A   200.6744       10.61843  1.730825   6.13489 8.52161e-10 6.09295e-06
GSTM1   161.8400        3.00860  0.475254   6.33050 2.44372e-10 3.49452e-06
ADGRL1   16.1937       -2.78108  0.579767  -4.79690 1.61140e-06 7.68102e-03
ASPM     46.2568        2.61048  0.622069   4.19644 2.71138e-05 2.98252e-02
HK3      14.9468        2.54071  0.717050   3.54328 3.95179e-04 7.24494e-02
IL2RB    14.2111        2.53780  0.691760   3.66861 2.43871e-04 6.17193e-02
VCAN     79.7772        2.30718  0.609475   3.78553 1.53383e-04 5.66734e-02
FCN1    195.2286        2.19370  0.526537   4.16628 3.09609e-05 3.05858e-02
GIMAP7   14.1011        1.99729  0.468686   4.26147 2.03086e-05 2.69092e-02
TLR2     14.2851        1.93756  0.491523   3.94196 8.08186e-05 4.50371e-02</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-10" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-10">6.2.5.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>res_df_pDC_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_pDC_IFNneg_vs_HC)</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>res_df_pDC_IFNneg_vs_HC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_pDC_IFNneg_vs_HC)</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>res_df_pDC_IFNneg_vs_HC <span class="ot">&lt;-</span> res_df_pDC_IFNneg_vs_HC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC_IFNneg_vs_HC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_pDC_IFNneg_vs_HC,</span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_pDC_IFNneg_vs_HC<span class="sc">$</span>gene,</span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb333-11"><a href="#cb333-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb333-12"><a href="#cb333-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNneg vs HC in pDC'</span>,</span>
<span id="cb333-13"><a href="#cb333-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb333-14"><a href="#cb333-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb333-15"><a href="#cb333-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb333-16"><a href="#cb333-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb333-17"><a href="#cb333-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb333-18"><a href="#cb333-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb333-19"><a href="#cb333-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb333-20"><a href="#cb333-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb333-21"><a href="#cb333-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb333-22"><a href="#cb333-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb333-23"><a href="#cb333-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb333-24"><a href="#cb333-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 103 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-110-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-pmn-ifnneg-vs-hc" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-pmn-ifnneg-vs-hc">6.2.6 Differential Expression Analysis for PMN (IFNneg vs HC)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNneg vs HC</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>res_PMN_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_PMN, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNneg"</span>, <span class="st">"HC"</span>))</span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>res_PMN_IFNneg_vs_HC <span class="ot">&lt;-</span> res_PMN_IFNneg_vs_HC[<span class="fu">order</span>(res_PMN_IFNneg_vs_HC<span class="sc">$</span>padj), ]</span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-7"><a href="#cb335-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb335-8"><a href="#cb335-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_PMN_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 17241 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 18, 0.1%
LFC &lt; 0 (down)     : 15, 0.087%
outliers [1]       : 0, 0%
low counts [2]     : 335, 1.9%
(mean count &lt; 3)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_PMN_IFNneg_vs_HC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 6 rows and 6 columns
             baseMean log2FoldChange     lfcSE      stat      pvalue
            &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
FOSB         97.35885       1.860304  0.341880   5.44139 5.28667e-08
C16orf54   6164.07769       0.510193  0.112096   4.55138 5.32946e-06
PPP1R16A      8.63263      -1.893807  0.416025  -4.55214 5.31019e-06
AF001548.5   89.37107       1.043330  0.237618   4.39079 1.12940e-05
EGR1        101.46674       2.462043  0.560568   4.39205 1.12286e-05
MTR          16.65358      -2.043840  0.472964  -4.32134 1.55081e-05
                  padj
             &lt;numeric&gt;
FOSB       0.000893764
C16orf54   0.030033269
PPP1R16A   0.030033269
AF001548.5 0.036667080
EGR1       0.036667080
MTR        0.036667080</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>resLFC_PMN_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_PMN,</span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNneg_vs_HC"</span>, </span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>res_sig_PMN_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_PMN_IFNneg_vs_HC, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-pmn-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-pmn-ifnneg-vs-hc">6.2.5.1 Exporting results for PMN (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_PMN_IFNneg_vs_HC), </span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_PMN_IFNneg_vs_HC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-5" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnneg-vs-hc-5">6.2.5.2 MA-plot of shrunken log2 fold changes (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_PMN_IFNneg_vs_HC,</span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNneg vs HC in PMN"</span>,</span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-pmn-ifnneg-vs-hc" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-pmn-ifnneg-vs-hc">6.2.5.3 Top 10 Differentially Expressed Genes in PMN (IFNneg vs HC)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_PMN_IFNneg_vs_HC[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_PMN_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNneg vs HC 
Wald test p-value: ifn status IFNneg vs HC 
DataFrame with 10 rows and 6 columns
            baseMean log2FoldChange     lfcSE      stat      pvalue      padj
           &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt; &lt;numeric&gt;
CR2          5.51780       -5.89313  1.445509  -4.07685 4.56497e-05 0.0580496
RGS16        4.53924       -3.62756  0.899296  -4.03378 5.48871e-05 0.0618615
CTSF         4.30842       -3.36229  0.881155  -3.81577 1.35760e-04 0.0791431
TAPT1-AS1    3.89926       -2.89491  0.678759  -4.26499 1.99908e-05 0.0366671
ZNF831       5.12525       -2.84604  0.691161  -4.11777 3.82556e-05 0.0538957
NKAPL        6.01965        2.84565  0.663079   4.29157 1.77415e-05 0.0366671
AC007950.2  13.84506        2.65930  0.663530   4.00780 6.12865e-05 0.0645659
REPS1       14.89053       -2.53631  0.671719  -3.77585 1.59460e-04 0.0881116
EGR1       101.46674        2.46204  0.560568   4.39205 1.12286e-05 0.0366671
EPB41L5     37.66630        2.17629  0.544869   3.99416 6.49249e-05 0.0645659</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-11" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-11">6.2.5.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>res_df_PMN_IFNneg_vs_HC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_PMN_IFNneg_vs_HC)</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>res_df_PMN_IFNneg_vs_HC<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_PMN_IFNneg_vs_HC)</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>res_df_PMN_IFNneg_vs_HC <span class="ot">&lt;-</span> res_df_PMN_IFNneg_vs_HC[<span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN_IFNneg_vs_HC<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN_IFNneg_vs_HC<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_PMN_IFNneg_vs_HC,</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_PMN_IFNneg_vs_HC<span class="sc">$</span>gene,</span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb346-10"><a href="#cb346-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb346-11"><a href="#cb346-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb346-12"><a href="#cb346-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNneg vs HC in PMN'</span>,</span>
<span id="cb346-13"><a href="#cb346-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb346-14"><a href="#cb346-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb346-15"><a href="#cb346-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb346-16"><a href="#cb346-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb346-17"><a href="#cb346-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb346-18"><a href="#cb346-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb346-19"><a href="#cb346-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb346-20"><a href="#cb346-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb346-21"><a href="#cb346-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb346-22"><a href="#cb346-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb346-23"><a href="#cb346-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb346-24"><a href="#cb346-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 25 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-116-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="differential-expression-analysis-for-ifnpos-vs-ifnneg" class="level2">
<h2 class="anchored" data-anchor-id="differential-expression-analysis-for-ifnpos-vs-ifnneg">6.3 Differential Expression Analysis for IFNpos vs IFNneg</h2>
<p>In this section, we perform differential expression analysis to identify genes that are significantly differentially expressed between interferon-positive (IFNpos) patients and interferon-negative (IFNneg) across various immune cell types.</p>
<section id="differential-expression-analysis-for-cmo-cells-ifnpos-vs-ifnneg" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-cmo-cells-ifnpos-vs-ifnneg">6.3.1 Differential Expression Analysis for cMo Cells (IFNpos vs IFNneg)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>coldata_cMo<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_cMo<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"IFNneg"</span>)</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>dds_cMo <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_cMo,</span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_cMo,</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>dds_cMo <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_cMo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 673 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs IFNneg</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>res_cMo_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_cMo, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"IFNneg"</span>))</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>res_cMo_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_cMo_IFNpos_vs_IFNneg[<span class="fu">order</span>(res_cMo_IFNpos_vs_IFNneg<span class="sc">$</span>padj), ]</span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_cMo_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 23365 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 1445, 6.2%
LFC &lt; 0 (down)     : 1075, 4.6%
outliers [1]       : 0, 0%
low counts [2]     : 906, 3.9%
(mean count &lt; 1)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_cMo_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
ISG15     2959.12        3.00044 0.1477120   20.3128 9.91050e-92 2.22580e-87
EIF2AK2   1371.42        1.81534 0.0931013   19.4986 1.12835e-84 8.44719e-81
LY6E      6767.12        3.02681 0.1551057   19.5145 8.26601e-85 8.44719e-81
IFI6      7850.30        3.19131 0.1643133   19.4221 5.01828e-84 2.81764e-80
IFI44L    3117.70        3.88749 0.2122436   18.3162 6.15043e-75 2.76265e-71
IFITM1    2738.47        3.24053 0.1770564   18.3023 7.93689e-75 2.97091e-71</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>resLFC_cMo_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_cMo,</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_IFNneg"</span>, </span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>res_sig_cMo_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_cMo_IFNpos_vs_IFNneg, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-cmo-cells-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-cmo-cells-ifnpos-vs-ifnneg">6.3.1.1 Exporting results for cMo Cells (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_cMo_IFNpos_vs_IFNneg), </span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_cMo_IFNpos_vs_IFNneg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg">6.3.1.2 MA-plot of shrunken log2 fold changes (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_cMo_IFNpos_vs_IFNneg,</span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs IFNneg in cMo"</span>,</span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-cmo-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-cmo-ifnpos-vs-ifnneg">6.3.1.3 Top 10 Differentially Expressed Genes in cMo (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_cMo_IFNpos_vs_IFNneg[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_cMo_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 10 rows and 6 columns
                 baseMean log2FoldChange     lfcSE      stat      pvalue
                &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
IFI27          1601.09952        7.27103  0.462979  15.70489 1.40024e-55
OTOF            274.27434        7.00243  0.602672  11.61897 3.30100e-31
PPP1R17           2.43508       -4.43409  1.354606  -3.27334 1.06283e-03
STAP1            15.04623        4.30865  0.813668   5.29534 1.18796e-07
USP18           469.19372        4.26835  0.288760  14.78165 1.92401e-49
GFAP              1.67187       -4.24809  1.520515  -2.79385 5.20843e-03
USP41            83.92032        4.19896  0.277910  15.10906 1.41142e-51
RP11-1260E13.4    1.29876        4.04060  1.365978   2.95803 3.09615e-03
KCTD14            4.98449        3.96408  0.876245   4.52394 6.06990e-06
CCDC81            1.63094       -3.89162  1.248573  -3.11685 1.82794e-03
                      padj
                 &lt;numeric&gt;
IFI27          1.31033e-52
OTOF           9.15273e-29
PPP1R17        1.74489e-02
STAP1          6.58776e-06
USP18          1.23461e-46
GFAP           5.79375e-02
USP41          9.90593e-49
RP11-1260E13.4 3.95843e-02
KCTD14         2.22026e-04
CCDC81         2.64863e-02</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-12" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-12">6.3.1.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a>res_df_cMo_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cMo_IFNpos_vs_IFNneg)</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a>res_df_cMo_IFNpos_vs_IFNneg<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cMo_IFNpos_vs_IFNneg)</span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a>res_df_cMo_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_df_cMo_IFNpos_vs_IFNneg[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo_IFNpos_vs_IFNneg<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_cMo_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_cMo_IFNpos_vs_IFNneg,</span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_cMo_IFNpos_vs_IFNneg<span class="sc">$</span>gene,</span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos_vs_IFNneg in cMo'</span>,</span>
<span id="cb369-13"><a href="#cb369-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb369-14"><a href="#cb369-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb369-15"><a href="#cb369-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb369-16"><a href="#cb369-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb369-17"><a href="#cb369-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb369-18"><a href="#cb369-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb369-19"><a href="#cb369-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb369-20"><a href="#cb369-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb369-21"><a href="#cb369-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb369-22"><a href="#cb369-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb369-23"><a href="#cb369-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb369-24"><a href="#cb369-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 2501 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-cdc-cells-ifnpos-vs-ifnneg" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-cdc-cells-ifnpos-vs-ifnneg">6.3.2 Differential Expression Analysis for cDC Cells (IFNpos vs IFNneg)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>coldata_cDC<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_cDC<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"IFNneg"</span>)</span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>dds_cDC <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_cDC,</span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_cDC,</span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a>dds_cDC <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_cDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 102 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs IFNneg</span></span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a>res_cDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_cDC, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"IFNneg"</span>))</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a>res_cDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_cDC_IFNpos_vs_IFNneg[<span class="fu">order</span>(res_cDC_IFNpos_vs_IFNneg<span class="sc">$</span>padj), ]</span>
<span id="cb381-6"><a href="#cb381-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-7"><a href="#cb381-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb381-8"><a href="#cb381-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_cDC_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 18625 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 753, 4%
LFC &lt; 0 (down)     : 625, 3.4%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 1)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_cDC_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFITM1   3325.129        3.52465  0.276566   12.7443 3.35228e-37 6.24363e-33
IFIT1     688.106        3.63790  0.298831   12.1738 4.28912e-34 3.99424e-30
IFI27    1272.994        9.33333  0.809070   11.5359 8.69981e-31 5.40113e-27
IFI6     2847.881        3.47113  0.317330   10.9385 7.54065e-28 3.51112e-24
ISG15    1460.197        2.81220  0.265409   10.5957 3.11916e-26 1.16189e-22
EIF2AK2  1024.439        1.76514  0.167523   10.5367 5.85259e-26 1.81674e-22</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a>resLFC_cDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_cDC,</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_IFNneg"</span>, </span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>res_sig_cDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_cDC_IFNpos_vs_IFNneg, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-cdc-cells-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-cdc-cells-ifnpos-vs-ifnneg">6.3.2.1 Exporting results for cDC Cells (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_cDC_IFNpos_vs_IFNneg), </span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_cDC_IFNpos_vs_IFNneg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-1" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-1">6.3.2.2 MA-plot of shrunken log2 fold changes (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_cDC_IFNpos_vs_IFNneg,</span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs IFNneg in cDC"</span>,</span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-128-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-cdc-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-cdc-ifnpos-vs-ifnneg">6.3.2.3 Top 10 Differentially Expressed Genes in cDC (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_cDC_IFNpos_vs_IFNneg[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_cDC_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 10 rows and 6 columns
           baseMean log2FoldChange     lfcSE      stat      pvalue        padj
          &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IL36A     101.84935      -11.05412  2.833627  -3.90105 9.57768e-05 4.18743e-03
IFI27    1272.99387        9.33333  0.809070  11.53587 8.69981e-31 5.40113e-27
OTOF       50.04154        9.03694  1.492563   6.05464 1.40729e-09 3.01273e-07
PTPRH       4.49211       -4.93292  1.164299  -4.23682 2.26707e-05 1.26042e-03
IFI44L   1998.83463        4.89002  0.492492   9.92914 3.10938e-23 5.26474e-20
TNFAIP6     9.92146        4.79073  0.932266   5.13880 2.76496e-07 3.35550e-05
GALR2       3.56876       -4.52439  1.467549  -3.08295 2.04957e-03 4.07398e-02
NTSR1       1.71336        4.48742  1.488547   3.01463 2.57291e-03 4.76497e-02
MTND1P32    3.80621       -4.46906  1.336434  -3.34402 8.25748e-04 2.11840e-02
EGR3        4.55683       -4.45140  1.532197  -2.90524 3.66968e-03 6.16435e-02</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-13" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-13">6.3.2.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>res_df_cDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_cDC_IFNpos_vs_IFNneg)</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>res_df_cDC_IFNpos_vs_IFNneg<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_cDC_IFNpos_vs_IFNneg)</span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>res_df_cDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_df_cDC_IFNpos_vs_IFNneg[<span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC_IFNpos_vs_IFNneg<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_cDC_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_cDC_IFNpos_vs_IFNneg,</span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_cDC_IFNpos_vs_IFNneg<span class="sc">$</span>gene,</span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb392-9"><a href="#cb392-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb392-10"><a href="#cb392-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb392-11"><a href="#cb392-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb392-12"><a href="#cb392-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos_vs_IFNneg in cDC'</span>,</span>
<span id="cb392-13"><a href="#cb392-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb392-14"><a href="#cb392-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb392-15"><a href="#cb392-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb392-16"><a href="#cb392-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb392-17"><a href="#cb392-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb392-18"><a href="#cb392-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb392-19"><a href="#cb392-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb392-20"><a href="#cb392-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb392-21"><a href="#cb392-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb392-22"><a href="#cb392-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb392-23"><a href="#cb392-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb392-24"><a href="#cb392-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 1369 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-b-cells-ifnpos-vs-ifnneg" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-b-cells-ifnpos-vs-ifnneg">6.3.3 Differential Expression Analysis for B Cells (IFNpos vs IFNneg)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>coldata_B_Cells<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_B_Cells<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"IFNneg"</span>)</span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>dds_B_Cells <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_B_Cells,</span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_B_Cells,</span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>dds_B_Cells <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_B_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 116 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs IFNneg</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>res_B_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_B_Cells, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"IFNneg"</span>))</span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>res_B_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_B_Cells_IFNpos_vs_IFNneg[<span class="fu">order</span>(res_B_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>padj), ]</span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_B_Cells_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 20081 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 166, 0.83%
LFC &lt; 0 (down)     : 231, 1.2%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 1)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_B_Cells_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
CMPK2     168.043        4.07385  0.294133  13.85036 1.26579e-43 2.54183e-39
IFI44L   1479.816        4.46368  0.405106  11.01855 3.11017e-28 3.12277e-24
IFI44     536.649        3.43363  0.364674   9.41562 4.70298e-21 3.14802e-17
RSAD2     187.138        3.56361  0.383576   9.29050 1.53562e-20 7.70921e-17
IFIT3     488.133        3.12375  0.337354   9.25957 2.05257e-20 8.24354e-17
EIF2AK2   858.377        1.58040  0.175377   9.01149 2.03284e-19 6.80357e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>resLFC_B_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_B_Cells,</span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_IFNneg"</span>, </span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>res_sig_B_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_B_Cells_IFNpos_vs_IFNneg, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-b-cells-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-b-cells-ifnpos-vs-ifnneg">6.3.3.1 Exporting results for B Cells (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_B_Cells_IFNpos_vs_IFNneg), </span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_B_Cells_IFNpos_vs_IFNneg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-2" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-2">6.3.3.2 MA-plot of shrunken log2 fold changes (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_B_Cells_IFNpos_vs_IFNneg,</span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs IFNneg in B Cells"</span>,</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-135-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-b-cells-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-b-cells-ifnpos-vs-ifnneg">6.3.3.3 Top 10 Differentially Expressed Genes in B Cells (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_B_Cells_IFNpos_vs_IFNneg[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_B_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 10 rows and 6 columns
            baseMean log2FoldChange     lfcSE      stat      pvalue        padj
           &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IL36A      117.48979      -10.52372  2.789373  -3.77279 1.61433e-04 2.55255e-02
OTOF         6.11952        6.58872  1.860004   3.54231 3.96633e-04 4.12684e-02
FRZB         5.14098       -5.39181  1.271656  -4.23999 2.23527e-05 6.50530e-03
LINC00487    4.18743        5.35515  1.100938   4.86417 1.14939e-06 5.59412e-04
NRIR        16.26801        4.66356  0.781035   5.97100 2.35810e-09 1.89412e-06
AHSP         5.01070        4.49716  1.432260   3.13991 1.69002e-03 9.27564e-02
IFI44L    1479.81593        4.46368  0.405106  11.01855 3.11017e-28 3.12277e-24
IFI27      254.35770        4.39135  1.034534   4.24476 2.18828e-05 6.46218e-03
CMPK2      168.04341        4.07385  0.294133  13.85036 1.26579e-43 2.54183e-39
SORBS2       2.75941       -3.61693  1.138929  -3.17573 1.49459e-03 8.70689e-02</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-14" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-14">6.3.3.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_B_Cells_IFNpos_vs_IFNneg)</span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_B_Cells_IFNpos_vs_IFNneg)</span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>res_df_B_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_df_B_Cells_IFNpos_vs_IFNneg[<span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_B_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_B_Cells_IFNpos_vs_IFNneg,</span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_B_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>gene,</span>
<span id="cb415-8"><a href="#cb415-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb415-9"><a href="#cb415-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb415-10"><a href="#cb415-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb415-11"><a href="#cb415-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb415-12"><a href="#cb415-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos_vs_IFNneg in B Cells'</span>,</span>
<span id="cb415-13"><a href="#cb415-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb415-14"><a href="#cb415-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb415-15"><a href="#cb415-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb415-16"><a href="#cb415-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb415-17"><a href="#cb415-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb415-18"><a href="#cb415-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb415-19"><a href="#cb415-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb415-20"><a href="#cb415-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb415-21"><a href="#cb415-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb415-22"><a href="#cb415-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb415-23"><a href="#cb415-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb415-24"><a href="#cb415-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 383 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-137-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-t-cells-ifnpos-vs-ifnneg" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-t-cells-ifnpos-vs-ifnneg">6.3.4 Differential Expression Analysis for T Cells (IFNpos vs IFNneg)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>coldata_T_Cells<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_T_Cells<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"IFNneg"</span>)</span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>dds_T_Cells <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_T_Cells,</span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_T_Cells,</span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a>dds_T_Cells <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_T_Cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 50 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs IFNneg</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>res_T_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_T_Cells, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"IFNneg"</span>))</span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>res_T_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_T_Cells_IFNpos_vs_IFNneg[<span class="fu">order</span>(res_T_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>padj), ]</span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_T_Cells_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 20883 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 651, 3.1%
LFC &lt; 0 (down)     : 283, 1.4%
outliers [1]       : 0, 0%
low counts [2]     : 4454, 21%
(mean count &lt; 11)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_T_Cells_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI6     2116.879        2.45020 0.2006343   12.2123 2.67244e-34 4.39056e-30
IFI44L   2005.728        4.36027 0.3761473   11.5919 4.52886e-31 3.72023e-27
MX1      1102.398        2.33735 0.2141153   10.9163 9.63411e-28 5.27596e-24
EIF2AK2  1200.942        1.49191 0.1396506   10.6832 1.22045e-26 4.63640e-23
MX2       644.440        1.03145 0.0966714   10.6697 1.41104e-26 4.63640e-23
OAS3      622.486        1.73400 0.1652433   10.4936 9.24393e-26 2.53114e-22</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>resLFC_T_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_T_Cells,</span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_IFNneg"</span>, </span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>res_sig_T_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_T_Cells_IFNpos_vs_IFNneg, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-t-cells-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-t-cells-ifnpos-vs-ifnneg">6.3.4.1 Exporting results for T Cells (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_T_Cells_IFNpos_vs_IFNneg), </span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_T_Cells_IFNpos_vs_IFNneg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-3" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-3">6.3.4.2 MA-plot of shrunken log2 fold changes (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_T_Cells_IFNpos_vs_IFNneg,</span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs IFNneg in T Cells"</span>,</span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-142-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-t-cells-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-t-cells-ifnpos-vs-ifnneg">6.3.4.3 Top 10 Differentially Expressed Genes in T Cells (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb436"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_T_Cells_IFNpos_vs_IFNneg[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_T_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 10 rows and 6 columns
        baseMean log2FoldChange     lfcSE      stat      pvalue        padj
       &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
IFI27   807.3096        6.27660  0.678512   9.25054 2.23352e-20 2.03858e-17
IFI44L 2005.7283        4.36027  0.376147  11.59192 4.52886e-31 3.72023e-27
OTOF     32.4095        3.83014  0.632953   6.05122 1.43749e-09 4.72329e-07
IFIT3   346.8381        3.10778  0.304750  10.19780 2.02804e-24 3.33187e-21
RSAD2   345.9063        2.94103  0.285100  10.31581 5.97771e-25 1.09120e-21
NRIR     15.4155        2.71360  0.358356   7.57236 3.66498e-14 1.77094e-11
USP41    59.5937        2.63105  0.277205   9.49135 2.28055e-21 2.34169e-18
CMPK2   205.6176        2.61257  0.264911   9.86208 6.07759e-23 8.32073e-20
USP18   376.3179        2.56782  0.273049   9.40426 5.23973e-21 5.06374e-18
IFIT1   267.1082        2.53234  0.261959   9.66691 4.16777e-22 4.56482e-19</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-15" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-15">6.3.4.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_T_Cells_IFNpos_vs_IFNneg)</span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_T_Cells_IFNpos_vs_IFNneg)</span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>res_df_T_Cells_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_df_T_Cells_IFNpos_vs_IFNneg[<span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_T_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_T_Cells_IFNpos_vs_IFNneg,</span>
<span id="cb438-7"><a href="#cb438-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_T_Cells_IFNpos_vs_IFNneg<span class="sc">$</span>gene,</span>
<span id="cb438-8"><a href="#cb438-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb438-9"><a href="#cb438-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb438-10"><a href="#cb438-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb438-11"><a href="#cb438-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb438-12"><a href="#cb438-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos_vs_IFNneg in T Cells'</span>,</span>
<span id="cb438-13"><a href="#cb438-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb438-14"><a href="#cb438-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb438-15"><a href="#cb438-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb438-16"><a href="#cb438-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb438-17"><a href="#cb438-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb438-18"><a href="#cb438-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb438-19"><a href="#cb438-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb438-20"><a href="#cb438-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb438-21"><a href="#cb438-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb438-22"><a href="#cb438-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb438-23"><a href="#cb438-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb438-24"><a href="#cb438-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 916 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-144-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-pdc-ifnpos-vs-ifnneg" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-pdc-ifnpos-vs-ifnneg">6.3.5 Differential Expression Analysis for pDC (IFNpos vs IFNneg)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a>coldata_pDC<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_pDC<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"IFNneg"</span>)</span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a>dds_pDC <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_pDC,</span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_pDC,</span>
<span id="cb440-5"><a href="#cb440-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span>
<span id="cb440-6"><a href="#cb440-6" aria-hidden="true" tabindex="-1"></a>dds_pDC <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_pDC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 78 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs IFNneg</span></span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>res_pDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_pDC, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"IFNneg"</span>))</span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-4"><a href="#cb450-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb450-5"><a href="#cb450-5" aria-hidden="true" tabindex="-1"></a>res_pDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_pDC_IFNpos_vs_IFNneg[<span class="fu">order</span>(res_pDC_IFNpos_vs_IFNneg<span class="sc">$</span>padj), ]</span>
<span id="cb450-6"><a href="#cb450-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-7"><a href="#cb450-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb450-8"><a href="#cb450-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_pDC_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 19119 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 288, 1.5%
LFC &lt; 0 (down)     : 168, 0.88%
outliers [1]       : 0, 0%
low counts [2]     : 0, 0%
(mean count &lt; 0)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_pDC_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
PARP14    419.582        3.16716  0.288484  10.97863 4.84192e-28 9.25726e-24
STAT1    4832.203        2.01657  0.186373  10.82012 2.76426e-27 2.64249e-23
IFI27     245.148        7.78971  0.734484  10.60569 2.80383e-26 1.78688e-22
EIF2AK2  1075.813        2.20925  0.212031  10.41950 2.02019e-25 9.65601e-22
LY6E     1018.817        3.83403  0.383003  10.01045 1.37130e-23 5.24358e-20
IFITM1    501.606        2.90149  0.293471   9.88681 4.74940e-23 1.51340e-19</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>resLFC_pDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_pDC,</span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_IFNneg"</span>, </span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>res_sig_pDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_pDC_IFNpos_vs_IFNneg, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-pdc-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-pdc-ifnpos-vs-ifnneg">6.3.5.1 Exporting results for pDC (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_pDC_IFNpos_vs_IFNneg), </span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_pDC_IFNpos_vs_IFNneg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-4" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-4">6.3.5.2 MA-plot of shrunken log2 fold changes (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb458"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_pDC_IFNpos_vs_IFNneg,</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs IFNneg in pDC"</span>,</span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-149-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-pdc-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-pdc-ifnpos-vs-ifnneg">6.3.5.3 Top 10 Differentially Expressed Genes in pDC (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_pDC_IFNpos_vs_IFNneg[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_pDC_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 10 rows and 6 columns
                baseMean log2FoldChange     lfcSE      stat      pvalue
               &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
IFI27          245.14788        7.78971  0.734484  10.60569 2.80383e-26
RP11-705O24.1    6.51858        5.58169  0.904628   6.17015 6.82241e-10
KDM5D           23.26211        4.81656  0.910466   5.29022 1.22171e-07
USP18          410.60234        4.74830  0.586033   8.10244 5.38662e-16
USP41           67.68563        4.69729  0.576113   8.15342 3.53762e-16
AC005780.1       4.00141       -4.56840  1.050162  -4.35019 1.36023e-05
IFI44L        3152.15000        4.29603  0.561802   7.64687 2.05933e-14
IFI44          732.66323        3.94476  0.502837   7.84501 4.32913e-15
UTY             23.33159        3.89262  0.749249   5.19536 2.04323e-07
CTNNAL1          9.03136        3.84661  0.847639   4.53803 5.67825e-06
                     padj
                &lt;numeric&gt;
IFI27         1.78688e-22
RP11-705O24.1 1.97633e-07
KDM5D         2.38981e-05
USP18         3.96103e-13
USP41         2.70543e-13
AC005780.1    1.66002e-03
IFI44L        1.19310e-11
IFI44         2.75896e-12
UTY           3.75620e-05
CTNNAL1       7.86685e-04</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-16" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-16">6.3.5.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>res_df_pDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_pDC_IFNpos_vs_IFNneg)</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a>res_df_pDC_IFNpos_vs_IFNneg<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_pDC_IFNpos_vs_IFNneg)</span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a>res_df_pDC_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_df_pDC_IFNpos_vs_IFNneg[<span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC_IFNpos_vs_IFNneg<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_pDC_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-6"><a href="#cb461-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_pDC_IFNpos_vs_IFNneg,</span>
<span id="cb461-7"><a href="#cb461-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_pDC_IFNpos_vs_IFNneg<span class="sc">$</span>gene,</span>
<span id="cb461-8"><a href="#cb461-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb461-9"><a href="#cb461-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb461-10"><a href="#cb461-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb461-11"><a href="#cb461-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb461-12"><a href="#cb461-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos_vs_IFNneg in pDC'</span>,</span>
<span id="cb461-13"><a href="#cb461-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb461-14"><a href="#cb461-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb461-15"><a href="#cb461-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb461-16"><a href="#cb461-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb461-17"><a href="#cb461-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb461-18"><a href="#cb461-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb461-19"><a href="#cb461-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb461-20"><a href="#cb461-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb461-21"><a href="#cb461-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb461-22"><a href="#cb461-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb461-23"><a href="#cb461-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb461-24"><a href="#cb461-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 421 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-151-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="differential-expression-analysis-for-pmn-ifnpos-vs-ifnneg" class="level3">
<h3 class="anchored" data-anchor-id="differential-expression-analysis-for-pmn-ifnpos-vs-ifnneg">6.3.6 Differential Expression Analysis for PMN (IFNpos vs IFNneg)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>coldata_PMN<span class="sc">$</span>ifn_status <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(coldata_PMN<span class="sc">$</span>ifn_status), <span class="at">ref =</span> <span class="st">"IFNneg"</span>)</span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>dds_PMN <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> cts_PMN,</span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colData =</span> coldata_PMN,</span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">design =</span> <span class="sc">~</span> ifn_status)</span>
<span id="cb463-6"><a href="#cb463-6" aria-hidden="true" tabindex="-1"></a>dds_PMN <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_PMN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 230 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results: IFNpos vs IFNneg</span></span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a>res_PMN_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_PMN, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"ifn_status"</span>, <span class="st">"IFNpos"</span>, <span class="st">"IFNneg"</span>))</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Order results by adjusted p-value</span></span>
<span id="cb473-5"><a href="#cb473-5" aria-hidden="true" tabindex="-1"></a>res_PMN_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_PMN_IFNpos_vs_IFNneg[<span class="fu">order</span>(res_PMN_IFNpos_vs_IFNneg<span class="sc">$</span>padj), ]</span>
<span id="cb473-6"><a href="#cb473-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-7"><a href="#cb473-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect summary</span></span>
<span id="cb473-8"><a href="#cb473-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res_PMN_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
out of 17241 with nonzero total read count
adjusted p-value &lt; 0.1
LFC &gt; 0 (up)       : 1251, 7.3%
LFC &lt; 0 (down)     : 1056, 6.1%
outliers [1]       : 0, 0%
low counts [2]     : 335, 1.9%
(mean count &lt; 3)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_PMN_IFNpos_vs_IFNneg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 6 rows and 6 columns
         baseMean log2FoldChange     lfcSE      stat      pvalue        padj
        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
HERC6     325.014        3.83337  0.306230   12.5179 5.95628e-36 1.00697e-31
TMEM123  4779.615        2.27720  0.187936   12.1169 8.59581e-34 7.26604e-30
IRF7     2198.851        2.39123  0.199073   12.0118 3.07898e-33 1.73511e-29
PARP14   2981.760        2.39380  0.202569   11.8172 3.18192e-32 1.34484e-28
SPATS2L   283.842        4.53304  0.385073   11.7719 5.44737e-32 1.84186e-28
TDRD7     621.561        2.37489  0.203043   11.6965 1.32809e-31 3.74212e-28</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shrink log2 fold changes</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a>resLFC_PMN_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(dds_PMN,</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">coef =</span> <span class="st">"ifn_status_IFNpos_vs_IFNneg"</span>, </span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"apeglm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using 'apeglm' for LFC shrinkage. If used in published research, please cite:
    Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for
    sequence count data: removing the noise and preserving large differences.
    Bioinformatics. https://doi.org/10.1093/bioinformatics/bty895</code></pre>
</div>
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset for significantly differentially expressed genes</span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a>res_sig_PMN_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">subset</span>(res_PMN_IFNpos_vs_IFNneg, <span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-results-for-pmn-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="exporting-results-for-pmn-ifnpos-vs-ifnneg">6.3.6.1 Exporting results for PMN (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export results</span></span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(res_sig_PMN_IFNpos_vs_IFNneg), </span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"results/DEG_significant_PMN_IFNpos_vs_IFNneg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-5" class="level4">
<h4 class="anchored" data-anchor-id="ma-plot-of-shrunken-log2-fold-changes-ifnpos-vs-ifnneg-5">6.3.6.2 MA-plot of shrunken log2 fold changes (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(resLFC_PMN_IFNpos_vs_IFNneg,</span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"MA Plot (Shrunken LFC): IFNpos vs IFNneg in PMN"</span>,</span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-156-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="top-10-differentially-expressed-genes-in-pmn-ifnpos-vs-ifnneg" class="level4">
<h4 class="anchored" data-anchor-id="top-10-differentially-expressed-genes-in-pmn-ifnpos-vs-ifnneg">6.3.6.3 Top 10 Differentially Expressed Genes in PMN (IFNpos vs IFNneg)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_sig_PMN_IFNpos_vs_IFNneg[<span class="fu">order</span>(<span class="fu">abs</span>(res_sig_PMN_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): ifn_status IFNpos vs IFNneg 
Wald test p-value: ifn status IFNpos vs IFNneg 
DataFrame with 10 rows and 6 columns
               baseMean log2FoldChange     lfcSE      stat      pvalue
              &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
OTOF          130.96602       10.44343  1.010050  10.33952 4.66871e-25
IFI27         317.09943        8.32967  0.867810   9.59850 8.11181e-22
RP11-288L9.1    7.14567        6.96089  0.900625   7.72895 1.08434e-14
SIGLEC1        61.42598        6.61065  0.785561   8.41520 3.92236e-17
USP41          70.01522        6.37416  0.653631   9.75192 1.81009e-22
USP18         423.57521        6.27584  0.783702   8.00794 1.16646e-15
CCNA1           6.11776        5.87689  1.592767   3.68974 2.24485e-04
TMEM255A        3.89381        5.74298  1.609778   3.56756 3.60323e-04
RTP4          318.83494        5.34961  0.815624   6.55891 5.42024e-11
IFI44L       3549.05385        5.32201  0.645580   8.24376 1.66882e-16
                    padj
               &lt;numeric&gt;
OTOF         6.07147e-22
IFI27        5.96253e-19
RP11-288L9.1 1.99330e-12
SIGLEC1      1.16336e-14
USP41        1.70008e-19
USP18        2.59476e-13
CCNA1        4.53421e-03
TMEM255A     6.64299e-03
RTP4         5.83660e-09
IFI44L       4.34047e-14</code></pre>
</div>
</div>
</section>
<section id="volcano-plot-17" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-17">6.3.6.4 Volcano Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame and clean</span></span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a>res_df_PMN_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resLFC_PMN_IFNpos_vs_IFNneg)</span>
<span id="cb484-3"><a href="#cb484-3" aria-hidden="true" tabindex="-1"></a>res_df_PMN_IFNpos_vs_IFNneg<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res_df_PMN_IFNpos_vs_IFNneg)</span>
<span id="cb484-4"><a href="#cb484-4" aria-hidden="true" tabindex="-1"></a>res_df_PMN_IFNpos_vs_IFNneg <span class="ot">&lt;-</span> res_df_PMN_IFNpos_vs_IFNneg[<span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN_IFNpos_vs_IFNneg<span class="sc">$</span>padj) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(res_df_PMN_IFNpos_vs_IFNneg<span class="sc">$</span>log2FoldChange), ]</span>
<span id="cb484-5"><a href="#cb484-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-6"><a href="#cb484-6" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(res_df_PMN_IFNpos_vs_IFNneg,</span>
<span id="cb484-7"><a href="#cb484-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> res_df_PMN_IFNpos_vs_IFNneg<span class="sc">$</span>gene,</span>
<span id="cb484-8"><a href="#cb484-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">'log2FoldChange'</span>,</span>
<span id="cb484-9"><a href="#cb484-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'padj'</span>,</span>
<span id="cb484-10"><a href="#cb484-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCutoff =</span> <span class="fl">0.1</span>,</span>
<span id="cb484-11"><a href="#cb484-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FCcutoff =</span> <span class="dv">0</span>,</span>
<span id="cb484-12"><a href="#cb484-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'IFNpos_vs_IFNneg in PMN'</span>,</span>
<span id="cb484-13"><a href="#cb484-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb484-14"><a href="#cb484-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">'log2 Fold Change'</span>,</span>
<span id="cb484-15"><a href="#cb484-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">'-log10 Adjusted p-value'</span>,</span>
<span id="cb484-16"><a href="#cb484-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb484-17"><a href="#cb484-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labSize =</span> <span class="fl">3.0</span>,</span>
<span id="cb484-18"><a href="#cb484-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'grey'</span>, <span class="st">'red'</span>),</span>
<span id="cb484-19"><a href="#cb484-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">'bottom'</span>,</span>
<span id="cb484-20"><a href="#cb484-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb484-21"><a href="#cb484-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendIconSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb484-22"><a href="#cb484-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb484-23"><a href="#cb484-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">widthConnectors =</span> <span class="fl">0.5</span>,</span>
<span id="cb484-24"><a href="#cb484-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabSize =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 2297 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLE_Transcriptome_Analysis_files/figure-html/unnamed-chunk-158-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="references" class="level1">
<h1>7. References</h1>
<p>Zhu, A., Ibrahim, J.G., Love, M.I. (2018) Heavy-tailed prior distributions for sequence count data: removing the noise and preserving large differences. Bioinformatics. <a href="https://doi.org/10.1093/bioinformatics/bty895" class="uri">https://doi.org/10.1093/bioinformatics/bty895</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>